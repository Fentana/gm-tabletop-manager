var DnD=function(){function e(e,i,s,t){return s=s?s:0,t=t?t:0,Math.floor(parseInt(e,10)+(parseInt(i,10)-parseInt(e,10))/4*parseInt(s,10)+(parseInt(i,10)-parseInt(e,10))/8*parseInt(t,10))}function i(){this.attributes={},this.reset=function(){attributes={}},this.get=function(e){return this.attributes[e]?this.attributes[e]:0},this.set=function(e,i){this.attributes[e]=parseInt(i,10)},this.increase=function(e,i){this.attributes[e]?this.attributes[e]+=parseInt(i,10):this.attributes[e]=parseInt(i,10)}}function s(e,i){this.key=e?e:"wis",this.value=parseInt(i,10)}function t(e,i,s){this.attribute1=e?e:"str",this.attribute2=i?i:"con",this.value=parseInt(s,10)}function a(a,h,r){this.name=a?a:"Unknown",this.npc=r,this.race="Unknown",this.career="Unknown",this.template="Unknown",this.size="Medium",this.origin="Natural",this.gender="male",this.height=155,this.weight=55,this.hasLowVision=!1,this.hasDarkVision=!1,this.bonusSkill=0,this.bonusAtWill=0,this.bonusInitiative=0,this.ap=0,this.regenerate=0,this.preferred=["str","con"],this.vision=function(){return this.hasDarkVision?"Dark Vision":this.hasLowVision?"Low Vision":"Normal Vision"},this.initiative=function(){return this.modLevel()+this.mod("dex")+this.bonusInitiative},this.actionPoint=function(){return this.npc?this.ap:1},this.speed=6,this.getSpeed=function(){return this.speed+("Dwarf"===this.race?0:this.armour.speed)},this.getSpeedInFeet=function(e){return Math.round(5*this.getSpeed()*(e/6))},this.getSpeedInMetres=function(e){return(.305*this.getSpeedInFeet(e)).toFixed(1)},this.getSpeedInYards=function(e){return(this.getSpeedInFeet(e)/3).toFixed(1)},this.getSpeedInMiles=function(e){return Math.round(this.getSpeedInYards(60*e)/1760)},this.getSpeedInKm=function(e){return Math.round(this.getSpeedInMetre(60*e)/1e3)},this.hpBase=10,this.hpLevel=4,this.spdBase=0,this.savingThrow=0,this.hp=function(){var e=1;if(this.npc){var i=Math.floor(this.hpBase/2)+2;e=this.get("con")+(h+1)*i}else e=this.hpBase+this.get("con")+(h-1)*this.hpLevel;switch(this.template){case"Standard":break;case"Minion":e=1;break;case"Solo":e=5*e;break;default:e=2*e}return e},this.bloodied=function(){return Math.floor(this.hp()/2)},this.surge=function(){return Math.floor(.25*this.hp()+("Dragonborn"===this.race?this.mod("con"):0))},this.surgePerDay=function(){return this.npc?0:this.spdBase+this.mod("con")},this.level=h?parseInt(h,10):1,this.modLevel=function(){return Math.floor(.5*this.level)},this.levelUp=function(){var e=(this.level>3?1:0)+(this.level>7?1:0)+Math.floor(Math.abs(this.level-4)/10)+Math.floor(Math.abs(this.level-8)/10),i=Math.floor(Math.abs(this.level-1)/10);if(this.attributes)for(var s in this.attributes)this.attributes[s]+=i,(s===this.preferred[0]||s===this.preferred[1])&&(this.attributes[s]+=e)},this.mod=function(e){return this.attributes[e]?Math.floor((this.attributes[e]-10)/2):0},this.attack=function(e){return this.attributes[e]?this.mod(e)+this.modLevel():0},this.defence={},this.addDefence=function(e,i,s,a){this.defence[e]=new t(i,s,a)},this.getDefence=function(e){return 10+this.defence[e].value+this.modLevel()+this.mod(this.mod(this.defence[e].attribute1)>this.mod(this.defence[e].attribute2)?this.defence[e].attribute1:this.defence[e].attribute2)},this.increaseDefence=function(e,i){this.defence[e]&&(this.defence[e].value+=i)},this.bonusAC=0,this.ac=function(){return 10+parseInt(this.bonusAC,10)+this.modLevel()+parseInt(this.armour.ac,10)+parseInt(this.armour.enchantment,10)+parseInt(this.armour.light?this.mod(this.mod("dex")>this.mod("int")?"dex":"int"):0)+(this.offhand.shield?this.offhand.prof+this.offhand.enchantment:0)},this.skill={},this.addSkill=function(e,i,t){this.skill[e]=new s(i,t)},this.increaseSkill=function(e,i){this.skill[e]&&(this.skill[e].value+=i)},this.getSkill=function(e){return this.mod(this.skill[e].key)+this.modLevel()+this.skill[e].value+("str"===this.skill[e].key||"dex"===this.skill[e].key?this.armour.check+(this.offhand.shield?this.offhand.check:0):0)},this.resistance=new i,this.getResists=function(){var e="";if(this.resistance.attributes)for(var i in this.resistance.attributes)e+=i+" +"+(this.resistance.get(i)+this.modLevel())+"<br />";return e},this.vulnerable=new i,this.getVulnerable=function(){var e="";if(this.vulnerable.attributes)for(var i in this.vulnerable.attributes)e+=i+" (Double Damage)<br />";return e},this.immunity=new i,this.getImmune=function(){var e="";if(this.immunity.attributes)for(var i in this.immunity.attributes)e+=i+" (No Damage)<br />";return e},this.xp=function(){var e=100+25*Math.max(this.level-1)+25*Math.max(0,this.level-5)+50*Math.max(0,this.level-9)+100*Math.max(0,this.level-13)+200*Math.max(0,this.level-17)+550*Math.max(0,this.level-21)+1050*Math.max(0,this.level-25)+2e3*Math.max(0,this.level-29)+4e3*Math.max(0,this.level-33)+8e3*Math.max(0,this.level-37);switch(this.template){case"Standard":break;case"Minion":e=Math.round(e/4);break;case"Solo":e=5*e;break;default:e=2*e}return e},this.armour={name:"Armour",type:"Cloth",ac:0,enchantment:0,light:1,check:0,speed:0,price:1,weight:4,properties:{}},this.getArmourPower=function(){var e="<p><b>Armour - "+this.armour.type+(this.armour.light?" (Light)":"")+"</b><br / > AC Bonus = "+this.armour.ac+"</p>";for(var i in this.armour.properties)e+="<p><b>"+i+"</b><br />"+this.armour.properties[i]+"</p>";return e},this.applyArmour=function(e,i,s){switch(this.armour.name=e,this.armour.type=i,this.armour.enchantment=parseInt(s,10),i){case"Leather":this.armour.ac=2,this.armour.light=1,this.armour.check=0,this.armour.speed=0,this.armour.price=25,this.armour.weight=15;break;case"Studded leather":this.armour.ac=3,this.armour.light=1,this.armour.check=0,this.armour.speed=0,this.armour.price=35,this.armour.weight=28,this.armour.properties.Tough="Reinforced with additional plates. In each encounter, first critical hit becomes normal hit";break;case"Hide":this.armour.ac=3,this.armour.light=1,this.armour.bonus=1,this.armour.check=-1,this.armour.speed=0,this.armour.price=30,this.armour.weight=25;break;case"Ring mail":this.armour.ac=3,this.armour.light=1,this.armour.check=-1,this.armour.speed=0,this.armour.price=40,this.armour.weight=30,this.armour.properties.Durable="On first hit, reduce damage by 2 (plus enchantment bonus). The property is lost until repaired";break;case"Chainmail":this.armour.ac=6,this.armour.bonus=0,this.armour.check=-1,this.armour.speed=-1,this.armour.price=40,this.armour.weight=40;break;case"Banded mail":this.armour.ac=6,this.armour.light=0,this.armour.check=-1,this.armour.speed=-1,this.armour.price=55,this.armour.weight=35,this.armour.properties.Tough="Reinforced with additional plates. In each encounter, first critical hit becomes normal hit";break;case"Scale":this.armour.ac=7,this.armour.light=0,this.armour.bonus=0,this.armour.check=0,this.armour.speed=-1,this.armour.price=45,this.armour.weight=45;break;case"Splint mail":this.armour.ac=7,this.armour.light=0,this.armour.check=-2,this.armour.speed=-1,this.armour.price=50,this.armour.weight=55,this.armour.properties.Durable="On first hit, reduce damage by 3 (plus 2 times the enchantment bonus). The property is lost until repaired";break;case"Plate":this.armour.ac=8,this.armour.light=0,this.armour.bonus=0,this.armour.check=-2,this.armour.speed=-1,this.armour.price=50,this.armour.weight=50;break;case"Spiked plate":this.armour.ac=8,this.armour.light=0,this.armour.check=-3,this.armour.speed=-1,this.armour.price=55,this.armour.weight=60,this.armour.properties.Barbed="Creature take 2 + half your level when you grab or escape the grab";break;case"Full plate":this.armour.ac=8,this.armour.light=0,this.armour.check=-1,this.armour.speed=-1,this.armour.price=65,this.armour.weight=60,this.armour.properties.Tough="Reinforced with additional plates. In each encounter, first critical hit becomes normal hit";break;default:this.armour.ac=0,this.armour.light=1,this.armour.check=0,this.armour.speed=0,this.armour.price=1,this.armour.weight=4,this.armour.properties={}}},this.melee={name:"Unarmed",type:"Empty",prof:0,enchantment:0,dice:1,side:4,twohands:0,price:0,weight:0,properties:{}},this.getMeleePower=function(){var e="<p><b>Melee - "+this.melee.type+"</b>"+(this.melee.twohands?"(Two-handed)":"")+"<br />+"+(this.melee.prof+this.melee.enchantment+this.mod("str")+this.modLevel())+" vs AC; Hit Damage = "+this.melee.dice+"d"+this.melee.side+" + "+(this.mod("str")+this.melee.enchantment)+"</p>";for(var i in this.melee.properties)e+="<p><b>"+i+"</b><br />"+this.melee.properties[i]+"</p>";return e},this.applyMelee=function(e,i,s){switch(this.melee.name=e,this.melee.type=i,this.melee.enchantment=parseInt(s,10),i){case"Club":this.melee.prof=2,this.melee.side=6,this.melee.price=1,this.melee.weight=3;break;case"Dagger":this.melee.prof=3,this.melee.price=1,this.melee.weight=1,this.melee.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead). Range 5/10.";break;case"Javelin":this.melee.prof=2,this.melee.side=6,this.melee.price=5,this.melee.weight=2,this.melee.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 10/20";break;case"Light mace":this.melee.prof=2,this.melee.side=6,this.melee.price=3,this.melee.weight=2,this.melee.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Mace":this.melee.prof=2,this.melee.side=8,this.melee.price=5,this.melee.weight=6,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Sickle":this.melee.prof=2,this.melee.side=6,this.melee.price=2,this.melee.weight=2;break;case"Short spear":this.melee.prof=2,this.melee.side=6,this.melee.price=2,this.melee.weight=1,this.melee.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead). Range 5/10.",this.melee.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Spear":this.melee.prof=2,this.melee.side=8,this.melee.price=5,this.melee.weight=6,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Greatclub":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=2,this.melee.side=4,this.melee.price=1,this.melee.weight=10;break;case"Morningstar":this.melee.twohands=1,this.melee.prof=2,this.melee.side=10,this.melee.price=10,this.melee.weight=8;break;case"Quaterstaff":this.melee.twohands=1,this.melee.prof=2,this.melee.side=8,this.melee.price=5,this.melee.weight=4;break;case"Scythe":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=2,this.melee.side=4,this.melee.price=5,this.melee.weight=10;break;case"Battleaxe":this.melee.prof=2,this.melee.side=10,this.melee.price=15,this.melee.weight=6,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Broadsword":this.melee.prof=2,this.melee.side=10,this.melee.price=20,this.melee.weight=5,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Flail":this.melee.prof=2,this.melee.side=10,this.melee.price=15,this.melee.weight=6,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Handaxe":this.melee.prof=2,this.melee.side=6,this.melee.price=5,this.melee.weight=3,this.melee.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 5/10.";break;case"Lance":this.melee.prof=2,this.melee.side=10,this.melee.price=12,this.melee.weight=10,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage",this.melee.properties.Mounted="More effective when on mount. When used not on a mount, take -2 attack penalty. When mounted, charges do an addition 1[W] extra damage";break;case"Light warpick":this.melee.prof=2,this.melee.side=6,this.melee.price=10,this.melee.weight=4,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21",this.melee.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Longsword":this.melee.prof=3,this.melee.side=8,this.melee.price=15,this.melee.weight=4,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Rapier":this.melee.prof=3,this.melee.side=8,this.melee.price=25,this.melee.weight=2;break;case"Scimitar":this.melee.prof=2,this.melee.side=8,this.melee.price=10,this.melee.weight=4,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21";break;case"Short sword":this.melee.prof=3,this.melee.side=6,this.melee.price=10,this.melee.weight=2;break;case"Throwing hammer":this.melee.prof=2,this.melee.side=6,this.melee.price=5,this.melee.weight=2,this.melee.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 5/10.";break;case"Warhammer":this.melee.prof=2,this.melee.side=10,this.melee.price=15,this.melee.weight=5,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Warpick":this.melee.prof=2,this.melee.side=8,this.melee.price=15,this.melee.weight=6,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21",this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Falchion":this.melee.twohands=1,this.melee.prof=3,this.melee.dice=2,this.melee.side=4,this.melee.price=25,this.melee.weight=7,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21";break;case"Glaive":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=2,this.melee.side=4,this.melee.price=25,this.melee.weight=10,this.melee.properties.Reach="Can attack enemies that are 2 squares away from you (as well as adjacent enemies)";break;case"Greataxe":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=1,this.melee.side=12,this.melee.price=30,this.melee.weight=8,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21";break;case"Greatsword":this.melee.twohands=1,this.melee.prof=3,this.melee.dice=1,this.melee.side=10,this.melee.price=30,this.melee.weight=8;break;case"Halberd":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=1,this.melee.side=10,this.melee.price=25,this.melee.weight=12,this.melee.properties.Reach="Can attack enemies that are 2 squares away from you (as well as adjacent enemies)";break;case"Heavy flail":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=2,this.melee.side=6,this.melee.price=25,this.melee.weight=10;break;case"Longspear":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=1,this.melee.side=10,this.melee.price=10,this.melee.weight=9,this.melee.properties.Reach="Can attack enemies that are 2 squares away from you (as well as adjacent enemies)";break;case"Maul":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=2,this.melee.side=6,this.melee.price=30,this.melee.weight=12;break;case"Pike":this.melee.twohands=1,this.melee.prof=2,this.melee.dice=1,this.melee.side=10,this.melee.price=15,this.melee.weight=6,this.melee.properties.Reach="Can attack enemies that are 2 squares away from you (as well as adjacent enemies)",this.melee.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Bastard sword":this.melee.prof=3,this.melee.dice=1,this.melee.side=10,this.melee.price=30,this.melee.weight=6,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Katar":this.melee.prof=3,this.melee.dice=1,this.melee.side=6,this.melee.price=3,this.melee.weight=1,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21";break;case"Serrated pick":this.melee.prof=2,this.melee.dice=1,this.melee.side=10,this.melee.price=15,this.melee.weight=4,this.melee.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21",this.melee.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"War axe":this.melee.prof=2,this.melee.dice=1,this.melee.side=12,this.melee.price=30,this.melee.weight=10,this.melee.properties.Versatile="Can be used as a two handed weapon for an extra point of damage";break;case"Whip":this.melee.prof=3,this.melee.dice=1,this.melee.side=4,this.melee.price=10,this.melee.weight=2,this.melee.properties.Reach="Can attack enemies that are 2 squares away from you (as well as adjacent enemies)";break;case"Spiked chain":this.melee.twohands=1,this.melee.prof=3,this.melee.dice=2,this.melee.side=4,this.melee.price=30,this.melee.weight=10,this.melee.properties.Reach="Can attack enemies that are 2 squares away from you (as well as adjacent enemies)";break;default:this.melee.prof=0,this.melee.dice=1,this.melee.side=4,this.melee.twohands=0,this.melee.price=0,this.melee.weight=0,this.melee.properties={}}},this.offhand={name:"Unarmed",type:"Empty",prof:0,enchantment:0,dice:1,side:4,shield:0,check:0,price:0,weight:0,properties:{}},this.getOffhandPower=function(){var e="";e=this.offhand.shield?"<p><b>Offhand - "+this.offhand.type+"</b><br /> AC Bonus = "+this.offhand.prof+"</p>":"<p><b>Offhand - "+this.offhand.type+"</b><br />+"+(this.offhand.prof+this.mod("str")+this.modLevel())+" vs AC; Hit Damage = "+this.offhand.dice+"d"+this.offhand.side+" + "+(this.offhand.enchantment+this.mod("str"))+"</p>";for(var i in this.offhand.properties)e+="<p><b>"+i+"</b><br />"+this.offhand.properties[i]+"</p>";return e},this.applyOffhand=function(e,i,s){switch(this.offhand.name=e,this.offhand.type=i,this.offhand.enchantment=parseInt(s,10),i){case"Light shield":this.offhand.shield=1,this.offhand.prof=1,this.offhand.check=0,this.offhand.price=5,this.offhand.weight=6;break;case"Heavy shield":this.offhand.shield=1,this.offhand.prof=2,this.offhand.check=-2,this.offhand.price=10,this.offhand.weight=15;break;case"Barbed shield":this.offhand.shield=1,this.offhand.prof=2,this.offhand.check=-3,this.offhand.price=20,this.offhand.weight=18,this.offhand.properties.Barbed="Creature takes damage 2 + one-half your level when you escape a grab or a creature escapes your grab";break;case"Dagger":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=3,this.offhand.price=1,this.offhand.weight=1,this.offhand.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead). Range 5/10.";break;case"Light mace":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=2,this.offhand.side=6,this.offhand.price=3,this.offhand.weight=2,this.offhand.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Sickle":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=2,this.offhand.side=6,this.offhand.price=2,this.offhand.weight=2;break;case"Short spear":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=2,this.offhand.side=6,this.offhand.price=2,this.offhand.weight=1,this.offhand.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead). Range 5/10.",this.offhand.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Handaxe":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=2,this.offhand.side=6,this.offhand.price=5,this.offhand.weight=3,this.offhand.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 5/10.";break;case"Light warpick":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=2,this.offhand.side=6,this.offhand.price=10,this.offhand.weight=4,this.offhand.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21",this.offhand.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Short sword":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=3,this.offhand.side=6,this.offhand.price=10,this.offhand.weight=2;break;case"Throwing hammer":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=2,this.offhand.side=6,this.offhand.price=5,this.offhand.weight=2,this.offhand.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 5/10.";break;case"Katar":this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=3,this.offhand.dice=1,this.offhand.side=6,this.offhand.price=3,this.offhand.weight=1,this.offhand.properties["High Crit"]="On critical, deal an extra 1[W] damage @ 1-10, 2[W] @ 11-20, 3[W] @ >21";break;default:this.offhand.shield=0,this.offhand.check=0,this.offhand.prof=0,this.offhand.dice=1,this.offhand.side=4,this.offhand.twohands=0,this.offhand.price=0,this.offhand.weight=0,this.offhand.properties={}}},this.range={name:"Improvised",type:"Improvised",key:"dex",twohands:0,prof:0,enchantment:0,dice:1,side:4,"short":5,"long":10,price:0,weight:0,properties:{}},this.getRangePower=function(){var e="<p><b>Ranged - "+this.range.type+(this.range.twohands?" (Two-handed)":"")+" (Range: "+this.range.short+"/"+this.range.long+")</b><br />+"+(this.range.prof+this.mod(this.range.key))+" vs AC; Hit Damage = "+this.range.dice+"d"+this.range.side+" + "+(this.mod(this.range.key)+this.range.enchantment)+"</p>";for(var i in this.range.properties)e+="<p><b>"+i+"</b><br />"+this.range.properties[i]+"</p>";return e},this.applyRange=function(e,i,s){switch(this.range.name=e,this.range.type=i,this.range.enchantment=parseInt(s,10),i){case"Hand crossbow":this.range.prof=2,this.range.side=6,this.range.short=10,this.range.long=20,this.range.price=25,this.range.weight=2,this.range.properties["Load free"]="Draw and load as a free action (Requires two hands)";break;case"Sling":this.range.prof=2,this.range.side=6,this.range.short=10,this.range.long=20,this.range.price=1,this.range.weight=0,this.range.properties["Load free"]="Draw and load as a free action (Requires two hands)";break;case"Crossbow":this.range.twohands=1,this.range.prof=2,this.range.side=8,this.range.short=15,this.range.long=30,this.range.price=25,this.range.weight=4,this.range.properties["Load minor"]="Draw and load as a minor action (Requires two hands)";break;case"Longbow":this.range.twohands=1,this.range.prof=2,this.range.side=10,this.range.short=20,this.range.long=40,this.range.price=30,this.range.weight=3,this.range.properties["Load free"]="Draw and load as a free action (Requires two hands)";break;case"Shortbow":this.range.twohands=1,this.range.prof=2,this.range.side=8,this.range.short=15,this.range.long=30,this.range.price=25,this.range.weight=2,this.range.properties["Load free"]="Draw and load as a free action (Requires two hands)",this.range.properties.Small="Small creatures can use in the same way a medium creature can";break;case"Shuriken":this.range.prof=3,this.range.side=4,this.range.short=6,this.range.long=12,this.range.price=1,this.range.weight=1,this.offhand.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead)";break;case"Javelin":this.range.key="str",this.range.short=10,this.range.long=20,this.range.prof=2,this.range.side=6,this.range.price=5,this.range.weight=2,this.range.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier)";break;case"Dagger":this.range.short=5,this.range.long=10,this.range.prof=2,this.range.side=4,this.range.price=1,this.range.weight=1,this.offhand.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead)";break;case"Short spear":this.range.short=5,this.range.long=10,this.range.prof=2,this.range.side=6,this.range.price=2,this.range.weight=1,this.range.properties["Light Thrown"]="Can be used as a ranged basic attack (use dexterity modifier instead). Range 5/10.",this.range.properties.Small="A small creature can use this weapon in the same manner as a medium creature can";break;case"Handaxe":this.range.short=5,this.range.long=10,this.range.prof=2,this.range.side=6,this.range.price=5,this.range.weight=3,this.range.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 5/10.";break;case"Throwing hammer":this.range.short=5,this.range.long=10,this.range.prof=2,this.range.side=6,this.range.price=5,this.range.weight=2,this.range.properties["Heavy Thrown"]="Can be used as a ranged basic attack (use strength modifier). Range 5/10.";break;default:this.range.name="Improvised",this.range.type="Improvised",this.range.key="dex",this.range.twohands=0,this.range.prof=0,this.range.enchantment=0,this.range.dice=1,this.range.side=4,this.range.short=5,this.range.long=10,this.range.price=0,this.range.weight=0,this.range.properties={}}},this.getAtWill=function(){return 2+this.bonusAtWill},this.getFeats=function(){return this.npc?0:1+Math.floor(this.level/2)+Math.floor((this.level-1)/10)+("Human"===this.race?1:0)},this.getEncounter=function(){if(this.npc){if(this.level>10&&this.level<=20)return 2;if(this.level>20)return 3}else{if(this.level>2&&this.level<7)return 2;if(this.level>=7&&this.level<11)return 3;if(this.level>=11)return 4}return 1},this.getDaily=function(){if(!this.npc){var e="Wizard"===this.career?2:1;return this.level>4&&this.level<9?2*e:this.level>=9&&this.level<21?3*e:this.level>=21?4*e:1*e}return 0},this.getUtility=function(){if(!this.npc){var e="Wizard"===this.career?2:1;if(this.level>1&&this.level<6)return 1*e;if(this.level>=6&&this.level<10)return 2*e;if(this.level>=10&&this.level<12)return 3*e;if(this.level>=12&&this.level<16)return 5*e;if(this.level>=16&&this.level<22)return 5*e;if(this.level>=22&&this.level<26)return 6*e;if(this.level>=26)return 7*e}return 0},this.applyRacial=function(i,s,t){switch(this.race=i,i){case"Bugbear":this.increase("str",2),this.increase("dex",2),this.increaseSkill("stealth",2),this.increaseSkill("intimidate",2),this.hasLowVision=!0,this.height=e(200,220,s),this.weight=e(110,135,t);break;case"Dragonborn":this.increase("str",2),this.increase("cha",2),this.increaseSkill("history",2),this.increaseSkill("intimidate",2),this.height=e(190,205,s),this.weight=e(100,150,t);break;case"Drow":this.origin="Fey",this.hasDarkVision=!0,this.increase("dex",2),this.increase("cha",2),this.increaseSkill("stealth",2),this.increaseSkill("intimidate",2),this.height=e(160,180,s),this.weight=e(60,80,t);break;case"Dwarf":this.speed=5,this.increase("con",2),this.increase("wis",2),this.increaseSkill("dungeon",2),this.increaseSkill("endurance",2),this.height=e(130,145,s),this.weight=e(70,100,t),this.hasLowVision=!0,this.resistance.set("poison",5);break;case"Eladrin":this.origin="Fey",this.increase("dex",2),this.increase("int",2),this.increaseSkill("arcana",2),this.increaseSkill("history",2),this.hasLowVision=!0,this.bonusSkill+=1,this.resistance.set("charm",5),this.height=e(165,185,s),this.weight=e(60,80,t),this.increaseDefence("will",1);break;case"Elf":this.origin="Fey",this.speed=7,this.hasLowVision=!0,this.increase("dex",2),this.increase("wis",2),this.increaseSkill("nature",2),this.increaseSkill("perception",2),this.height=e(145,185,s),this.weight=e(55,75,t);break;case"Gnoll":this.speed=7,this.hasLowVision=!0,this.increase("con",2),this.increase("dex",2),this.increaseSkill("intimidate",2),this.height=e(210,230,s),this.weight=e(125,145,t);break;case"Gnome":this.origin="Fey",this.speed=5,this.hasLowVision=!0,this.size="Small",this.increase("int",2),this.increase("cha",2),this.increaseSkill("arcana",2),this.increaseSkill("stealth",2),this.resistance.set("illusion",5),this.height=e(100,115,s),this.weight=e(20,35,t);break;case"Goblin":this.hasLowVision=!0,this.size="Small",this.increase("dex",2),this.increase("cha",2),this.increaseSkill("thievery",2),this.increaseSkill("stealth",2),this.increaseDefence("reflex",1),this.height=e(100,115,s),this.weight=e(20,30,t);break;case"Goliath":this.increase("str",2),this.increase("con",2),this.increaseSkill("athletics",2),this.increaseSkill("nature",2),this.increaseDefence("will",1),this.height=e(200,230,s),this.weight=e(125,155,t);break;case"Half-Elf":this.hasLowVision=!0,this.increase("cha",2),this.increase("con",2),this.increaseSkill("diplomacy",2),this.increaseSkill("insight",2),this.height=e(165,190,s),this.weight=e(60,85,t);break;case"Half-Orc":this.hasLowVision=!0,this.increase("str",2),this.increase("dex",2),this.increaseSkill("endurance",2),this.increaseSkill("intimidate",2),this.height=e(175,195,s),this.weight=e(70,105,t);break;case"Halfling":this.size="Small",this.increase("cha",2),this.increase("dex",2),this.increaseSkill("acrobatics",2),this.increaseSkill("thievery",2),this.height=e(115,130,s),this.weight=e(35,40,t),this.resistance.set("fear",5);break;case"Hobgoblin":this.increase("con",2),this.increase("cha",2),this.increaseSkill("athletics",2),this.increaseSkill("history",2),this.bonusInitiative+=2,this.hasLowVision=!0,this.height=e(180,195,s),this.weight=e(85,110,t);break;case"Human":this.bonusSkill+=1,this.bonusAtWill+=1,this.increase(this.preferred[0],2),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.height=e(165,190,s),this.weight=e(60,100,t);break;case"Kobold":this.size="Small",this.increase("dex",2),this.increase("con",2),this.increaseSkill("stealth",2),this.increaseSkill("thievery",2),this.increaseDefence("will",1),this.height=e(105,120,s),this.weight=e(30,35,t);break;case"Minotaur":this.increase("str",2),this.increase("con",2),this.increaseSkill("nature",2),this.increaseSkill("perception",2),this.height=e(210,230,s),this.weight=e(145,160,t);break;case"Orc":this.hasLowVision=!0,this.increase("str",2),this.increase("con",2),this.height=e(180,195,s),this.weight=e(90,105,t);break;case"Tiefling":this.hasLowVision=!0,this.increase("int",2),this.increase("cha",2),this.increaseSkill("stealth",2),this.increaseSkill("bluff",2),this.resistance.set("fire",5),this.height=e(170,195,s),this.weight=e(65,110,t)}},this.applyClass=function(e){switch(this.career=e,e){case"Cleric":this.increaseSkill("religion",5),this.increaseDefence("will",2),this.bonusSkill+=this.npc?1:3,this.hpBase=12,this.hpLevel=5,this.spdBase=7;break;case"Fighter":this.increaseDefence("fort",2),this.bonusSkill+=this.npc?2:3,this.hpBase=15,this.hpLevel=6,this.spdBase=9;break;case"Paladin":this.increaseSkill("religion",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusSkill+=this.npc?1:3,this.hpBase=15,this.hpLevel=6,this.spdBase=10;break;case"Ranger":this.increaseSkill("dungeon",5),this.increaseSkill("nature",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.npc||(this.bonusSkill+=3),this.hpBase=12,this.hpLevel=5,this.spdBase=6;break;case"Rogue":this.increaseSkill("stealth",5),this.increaseSkill("thievery",5),this.increaseDefence("reflex",2),this.npc||(this.bonusSkill+=4),this.hpBase=12,this.hpLevel=5,this.spdBase=6;break;case"Warlock":this.increaseDefence("will",1),this.increaseDefence("reflex",1),this.bonusSkill+=this.npc?2:4,this.hpBase=12,this.hpLevel=5,this.spdBase=6;break;case"Warlord":this.increaseDefence("fort",1),this.increaseDefence("will",1),this.bonusSkill+=this.npc?2:4,this.hpBase=12,this.hpLevel=5,this.spdBase=7;break;case"Wizard":this.increaseSkill("arcana",5),this.increaseDefence("will",2),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Aristocrat":this.increaseSkill("diplomacy",5),this.increaseDefence("will",2),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Artisan":this.increaseSkill("dungeon",5),this.increaseDefence("fort",1),this.increaseDefence("will",1),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Commoner":this.increaseSkill("streetwise",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Courtesan":this.increaseSkill("insight",5),this.increaseDefence("will",1),this.increaseDefence("reflex",1),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Criminal":this.increaseSkill("thievery",5),this.increaseDefence("reflex",2),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Healer":this.increaseSkill("heal",5),this.increaseDefence("will",2),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Labourer":this.increaseSkill("endurance",5),this.increaseDefence("fort",2),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Merchant":this.increaseSkill("insight",5),this.increaseDefence("will",1),this.increaseDefence("reflex",1),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Priest":this.increaseSkill("religion",5),this.increaseDefence("will",1),this.bonusSkill+=this.npc?1:3,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Scholar":this.increaseSkill("history",5),this.increaseDefence("will",1),this.bonusSkill+=this.npc?2:4,this.hpBase=10,this.hpLevel=4,this.spdBase=6;break;case"Artillery":this.increaseSkill("perception",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusSkill+=this.npc?1:3,this.hpBase=8,this.hpLevel=4,this.spdBase=6;break;case"Brute":this.increaseSkill("athletics",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusSkill+=this.npc?1:3,this.hpBase=16,this.hpLevel=5,this.spdBase=7;break;case"Controller":this.increaseSkill("perception",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusSkill+=this.npc?1:3,this.hpBase=12,this.hpLevel=4,this.spdBase=6;break;case"Lurker":this.increaseSkill("stealth",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusInitiative+=4,this.bonusSkill+=this.npc?1:3,this.hpBase=8,this.hpLevel=4,this.spdBase=6;break;case"Skirmisher":this.increaseSkill("athletics",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusInitiative+=2,this.bonusSkill+=this.npc?1:3,this.hpBase=12,this.hpLevel=4,this.spdBase=6;break;case"Soldier":this.increaseSkill("endurance",5),this.increaseDefence("fort",1),this.increaseDefence("reflex",1),this.increaseDefence("will",1),this.bonusInitiative+=2,this.bonusSkill+=this.npc?1:3,this.hpBase=12,this.hpLevel=4,this.spdBase=6}},this.applyTemplate=function(e){switch(this.template=e,e){case"Minion":break;case"Solo":this.ap=1,this.bonusAtWill+=1,this.savingThrow+=5;break;case"Acolyte":this.origin+=" (demon)",this.resistance.increase("fire",5),this.resistance.increase("necrotic",5),this.resistance.increase("disease",5),this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("will",2);break;case"Adept of Frost":this.origin+=" (elemental)",this.resistance.increase("cold",5),this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("reflex",2);break;case"Adept of Flame":this.origin+=" (elemental)",this.resistance.increase("fire",5),this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("reflex",2);break;case"Adept of Lightning":this.origin+=" (elemental)",this.resistance.increase("lightning",5),this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("reflex",2);break;case"Adept of Thunder":this.origin+=" (elemental)",this.resistance.increase("thunder",5),this.savingThrow+=2,this.ap=1,this.increaseDefence("will",2),this.increaseDefence("reflex",2);break;case"Battle Champion":this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("reflex",2),this.increaseDefence("will",2);break;case"Bodyguard":this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",4),this.increaseDefence("reflex",1),this.increaseDefence("will",1);break;case"Death Knight":this.origin+=" (undead)",this.hasDarkVision=!0,this.immunity.set("disease",1),this.immunity.set("poison",1),this.resistance.increase("necrotic",5),this.vulnerable.increase("radiant",10),this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",4),this.increaseDefence("will",2);break;case"Death Master":this.origin+=" (shadow)",this.hasDarkVision=!0,this.resistance.increase("necrotic",5),this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("will",2);break;case"Demagogue":this.savingThrow+=2,this.ap=1,this.resistance.increase("charm",5),this.resistance.increase("fear",5),this.increaseDefence("fort",2),this.increaseDefence("will",4);break;case"Devastator":this.savingThrow+=2,this.ap=1,this.increaseDefence("reflex",2);break;case"Feyborn":this.origin+=" (fey)",this.savingThrow+=2,this.ap=1,this.increaseDefence("reflex",2),this.increaseDefence("will",2);break;case"Lich":this.origin+=" (undead)",this.hasDarkVision=!0,this.immunity.set("disease",1),this.immunity.set("poison",1),this.resistance.increase("necrotic",5),this.savingThrow+=2,this.ap=1,this.regenerate=10,this.increaseDefence("fort",4),this.increaseDefence("will",4);break;case"Mummy Champion":this.origin+=" (undead)",this.hasDarkVision=!0,this.immunity.set("disease",1),this.immunity.set("poison",1),this.resistance.increase("necrotic",5),this.savingThrow+=2,this.ap=1,this.regenerate=10,this.increaseDefence("fort",2),this.increaseDefence("will",4);break;case"Mummy Lord":this.origin+=" (undead)",this.hasDarkVision=!0,this.immunity.set("disease",1),this.immunity.set("poison",1),this.resistance.increase("necrotic",5),this.savingThrow+=2,this.ap=1,this.regenerate=10,this.increaseDefence("fort",2),this.increaseDefence("will",4);break;case"Savage Berserker":this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",4),this.regenerate=10;break;case"Shadowborn":this.origin+=" (shadow)",this.hasDarkVision=!0,this.savingThrow+=2,this.ap=1,this.increaseDefence("fort",2),this.increaseDefence("reflex",2),this.increaseDefence("will",2);break;case"Vampire Lord":this.origin+=" (undead)",this.hasDarkVision=!0,this.immunity.set("disease",1),this.immunity.set("poison",1),this.resistance.increase("necrotic",5),this.vulnerable.increase("radiant",5),this.savingThrow+=2,this.ap=1,this.regenerate=10,this.increaseDefence("fort",2),this.increaseDefence("reflex",2),this.increaseDefence("will",2);break;default:this.ap=1,this.savingThrow+=2}}}return a.prototype=new i,{blank:new a,create4E:function(e,i,s,t,h,r,n,l,o,c){var d=new a(e,i,r);return d.set("str",n[0]),d.set("con",n[1]),d.set("dex",n[2]),d.set("int",n[3]),d.set("wis",n[4]),d.set("cha",n[5]),d.preferred=l,d.addDefence("fort","str","con",0),d.addDefence("reflex","dex","int",0),d.addDefence("will","wis","cha",0),d.addSkill("acrobatics","dex",0),d.addSkill("arcana","int",0),d.addSkill("athletics","str",0),d.addSkill("bluff","cha",0),d.addSkill("diplomacy","cha",0),d.addSkill("dungeon","wis",0),d.addSkill("endurance","con",0),d.addSkill("heal","wis",0),d.addSkill("history","int",0),d.addSkill("insight","wis",0),d.addSkill("intimidate","cha",0),d.addSkill("nature","wis",0),d.addSkill("perception","wis",0),d.addSkill("religion","int",0),d.addSkill("stealth","dex",0),d.addSkill("streetwise","cha",0),d.addSkill("thievery","dex",0),d.applyRacial(s,o,c),d.applyClass(t),d.applyTemplate(h),d.levelUp(),d},serialise:function(e){return e.attributes&&(e.abilities=e.attributes),JSON.stringify(e)},deserialise:function(e){var i=JSON.parse(e);if(null!==i&&"object"==typeof i){var s=new a(i.name,i.level,i.npc);for(var t in i)if("object"==typeof i[t])switch(t){case"abilities":for(var h in i[t])s.set(h,i[t][h]);break;case"defence":for(var r in i[t])s.addDefence(r,i[t][r].attribute1,i[t][r].attribute2,i[t][r].value);break;case"immunity":for(var n in i[t].attributes)s.immunity.set(n,i[t].attributes[n]);break;case"resistance":for(var l in i[t].attributes)s.resistance.set(l,i[t].attributes[l]);break;case"skill":for(var o in i[t])s.addSkill(o,i[t][o].key,i[t][o].value);break;case"vulnerable":for(var c in i[t].attributes)s.vulnerable.set(c,i[t].attributes[c]);break;default:s[t]=i[t]}else s[t]=i[t];return s}return null}}}(window);