var DnD=(function(d){function f(i,g,h,j){h=h?h:0;j=j?j:0;return Math.floor(parseInt(i,10)+(((parseInt(g,10)-parseInt(i,10))/4)*parseInt(h,10))+((((parseInt(g,10)-parseInt(i,10))/8)*parseInt(j,10))))}function c(){this.attributes={};this.reset=function(){attributes={}};this.get=function(g){if(this.attributes[g]){return this.attributes[g]}return 0};this.set=function(g,h){this.attributes[g]=parseInt(h,10)};this.increase=function(g,h){if(this.attributes[g]){this.attributes[g]+=parseInt(h,10)}else{this.attributes[g]=parseInt(h,10)}}}function e(g,h){this.key=g?g:"wis";this.value=parseInt(h,10)}function b(h,g,i){this.attribute1=h?h:"str";this.attribute2=g?g:"con";this.value=parseInt(i,10)}function a(h,i,g){this.name=h?h:"Unknown";this.npc=g;this.race="Unknown";this.career="Unknown";this.template="Unknown";this.speed=6;this.size="Medium";this.origin="Natural";this.gender="male";this.height=155;this.weight=55;this.hasLowVision=false;this.hasDarkVision=false;this.bonusSkill=0;this.bonusAtWill=0;this.bonusInitiative=0;this.ap=0;this.regenerate=0;this.preferred=["str","con"];this.vision=function(){return(this.hasDarkVision)?"Dark Vision":(this.hasLowVision?"Low Vision":"Normal Vision")};this.initiative=function(){return this.modLevel()+this.mod("dex")+this.bonusInitiative};this.actionPoint=function(){if(!this.npc){return 1}return this.ap};this.hpBase=10;this.hpLevel=4;this.spdBase=0;this.savingThrow=0;this.hp=function(){var k=1;if(this.npc){var j=(this.hpBase/2)+2;k=this.get("con")+((i+1)*j)}else{k=this.hpBase+this.get("con")+((i-1)*this.hpLevel)}switch(this.template){case"Standard":break;case"Minion":k=1;break;case"Solo":k=k*5;break;default:k=k*2;break}return k};this.bloodied=function(){return Math.floor(this.hp()/2)};this.surge=(function(){return Math.floor(this.hp()*0.25+((this.race==="Dragonborn")?this.mod("con"):0))});this.surgePerDay=(function(){if(this.npc){return 0}return(this.spdBase+this.mod("con"))});this.level=i?parseInt(i,10):1;this.modLevel=function(){return Math.floor(this.level*0.5)};this.levelUp=function(){var k=(this.level>3?1:0)+(this.level>7?1:0)+Math.floor(Math.abs(this.level-4)/10)+Math.floor(Math.abs(this.level-8)/10);var j=Math.floor(Math.abs(this.level-1)/10);for(ability in this.attributes){this.attributes[ability]+=j;if(ability===this.preferred[0]||ability===this.preferred[1]){this.attributes[ability]+=k}}};this.mod=function(j){if(this.attributes[j]){return Math.floor((this.attributes[j]-10)/2)}return 0};this.attack=function(j){if(this.attributes[j]){return this.mod(j)+this.modLevel()}return 0};this.defence={};this.addDefence=function(k,l,j,m){this.defence[k]=new b(l,j,m)};this.getDefence=function(j){return 10+this.defence[j].value+this.modLevel()+(this.mod(this.defence[j].attribute1)>this.mod(this.defence[j].attribute2)?this.mod(this.defence[j].attribute1):this.mod(this.defence[j].attribute2))};this.increaseDefence=function(j,k){if(this.defence[j]){this.defence[j].value+=k}};this.bonusAC=0;this.ac=function(){return 10+parseInt(this.bonusAC,10)+this.modLevel()+parseInt(this.armour.ac,10)+parseInt(this.armour.enchantment,10)+parseInt((this.armour.light?(this.mod("dex")>this.mod("int")?this.mod("dex"):this.mod("int")):0))};this.skill={};this.addSkill=function(j,k,l){this.skill[j]=new e(k,l)};this.increaseSkill=function(j,k){if(this.skill[j]){this.skill[j].value+=k}};this.getSkill=function(j){return this.mod(this.skill[j].key)+this.modLevel()+this.skill[j].value};this.resistance=new c();this.getResists=function(){var k="";for(var j in this.resistance.attributes){k+=j+" +"+(this.resistance.get(j)+this.modLevel())+"<br />"}return k};this.vulnerable=new c();this.getVulnerable=function(){var k="";for(var j in this.vulnerable.attributes){k+=j+" (Double Damage)<br />"}return k};this.immunity=new c();this.getImmune=function(){var k="";for(var j in this.immunity.attributes){k+=j+" (No Damage)<br />"}return k};this.xp=function(){var j=100+(25*Math.max(this.level-1))+(25*Math.max(0,this.level-5))+(50*Math.max(0,this.level-9))+(100*Math.max(0,this.level-13))+(200*Math.max(0,this.level-17))+(550*Math.max(0,this.level-21))+(1050*Math.max(0,this.level-25))+(2000*Math.max(0,this.level-29))+(4000*Math.max(0,this.level-33))+(8000*Math.max(0,this.level-37));switch(this.template){case"Standard":break;case"Minion":j=Math.round(j/4);break;case"Solo":j=j*5;break;default:j=j*2;break}return j};this.armour={name:"Armour",type:"Cloth",ac:0,enchantment:0,light:1,check:0,speed:0,price:1,weight:4,properties:{}};this.getArmourPower=function(){var j="";for(power in this.armour.properties){j+="<p><b>"+power+"</b><br />"+this.armour.properties[power]+"</p>"}return j};this.applyArmour=function(j,l,k){this.armour.name=j;this.armour.type=l;this.armour.enchantment=k;switch(l){case"Leather":this.armour.ac=2;this.armour.light=1;this.armour.check=0;this.armour.speed=0;this.armour.price=25;this.armour.weight=15;break;case"Studded leather":this.armour.ac=3;this.armour.light=1;this.armour.check=0;this.armour.speed=0;this.armour.price=35;this.armour.weight=28;this.armour.properties.Tough="Reinforced with additional plates. In each encounter, first critical hit becomes normal hit";break;case"Hide":this.armour.ac=3;this.armour.light=1;this.armour.bonus=1;this.armour.check=-1;this.armour.speed=0;this.armour.price=30;this.armour.weight=25;break;case"Ring mail":this.armour.ac=3;this.armour.light=1;this.armour.check=-1;this.armour.speed=0;this.armour.price=40;this.armour.weight=30;this.armour.properties.Durable="On first hit, reduce damage by 2 (plus enchantment bonus). The property is lost until repaired";break;case"Chainmail":this.armour.ac=6;this.armour.bonus=0;this.armour.check=-1;this.armour.speed=-1;this.armour.price=40;this.armour.weight=40;break;case"Banded mail":this.armour.ac=6;this.armour.light=0;this.armour.check=-1;this.armour.speed=-1;this.armour.price=55;this.armour.weight=35;this.armour.properties.Tough="Reinforced with additional plates. In each encounter, first critical hit becomes normal hit";break;case"Scale":this.armour.ac=7;this.armour.bonus=0;this.armour.check=0;this.armour.speed=-1;this.armour.price=45;this.armour.weight=45;break;case"Splint mail":this.armour.ac=7;this.armour.light=0;this.armour.check=-2;this.armour.speed=-1;this.armour.price=50;this.armour.weight=55;this.armour.properties.Durable="On first hit, reduce damage by 3 (plus 2 times the enchantment bonus). The property is lost until repaired";break;case"Plate":this.armour.ac=8;this.armour.bonus=0;this.armour.check=-2;this.armour.speed=-1;this.armour.price=50;this.armour.weight=50;break;case"Spiked plate":this.armour.ac=8;this.armour.light=0;this.armour.check=-3;this.armour.speed=-1;this.armour.price=55;this.armour.weight=60;this.armour.properties.Barbed="Creature take 2 + half your level when you grab or escape the grab";break;case"Full plate":this.armour.ac=8;this.armour.light=0;this.armour.check=-1;this.armour.speed=-1;this.armour.price=65;this.armour.weight=60;this.armour.properties.Tough="Reinforced with additional plates. In each encounter, first critical hit becomes normal hit";break;default:this.armour.ac=0;this.armour.light=1;this.armour.check=0;this.armour.speed=0;this.armour.price=1;this.armour.weight=4;this.armour.properties={};break}};this.getAtWill=(function(){return 2+this.bonusAtWill});this.getFeats=(function(){return(this.npc)?0:1+Math.floor(this.level/2)+Math.floor((this.level-1)/10)+((this.race==="Human")?1:0)});this.getEncounter=(function(){if(this.level>2&&this.level<7){return 2}else{if(this.level>=7&&this.level<11){return 3}else{if(this.level>=11){return 4}}}return 1});this.getDaily=(function(){var j=(this.career==="Wizard")?2:1;if(this.level>4&&this.level<9){return 2*j}else{if(this.level>=9&&this.level<21){return 3*j}else{if(this.level>=21){return 4*j}}}return 1*j});this.getUtility=(function(){var j=(this.career==="Wizard")?2:1;if(this.level>1&&this.level<6){return 1*j}else{if(this.level>=6&&this.level<10){return 2*j}else{if(this.level>=10&&this.level<12){return 3*j}else{if(this.level>=12&&this.level<16){return 5*j}else{if(this.level>=16&&this.level<22){return 5*j}else{if(this.level>=22&&this.level<26){return 6*j}else{if(this.level>=26){return 7*j}}}}}}}return 0});this.applyRacial=function(k,l,j){this.race=k;switch(k){case"Bugbear":this.increase("str",2);this.increase("dex",2);this.increaseSkill("stealth",2);this.increaseSkill("intimidate",2);this.hasLowVision=true;this.height=f(200,220,l);this.weight=f(110,135,j);break;case"Dragonborn":this.increase("str",2);this.increase("cha",2);this.increaseSkill("history",2);this.increaseSkill("intimidate",2);this.height=f(190,205,l);this.weight=f(100,150,j);break;case"Drow":this.origin="Fey";this.hasDarkVision=true;this.increase("dex",2);this.increase("cha",2);this.increaseSkill("stealth",2);this.increaseSkill("intimidate",2);this.height=f(160,180,l);this.weight=f(60,80,j);break;case"Dwarf":this.speed=5;this.increase("con",2);this.increase("wis",2);this.increaseSkill("dungeon",2);this.increaseSkill("endurance",2);this.height=f(130,145,l);this.weight=f(70,100,j);this.hasLowVision=true;this.resistance.set("poison",5);break;case"Eladrin":this.origin="Fey";this.increase("dex",2);this.increase("int",2);this.increaseSkill("arcana",2);this.increaseSkill("history",2);this.hasLowVision=true;this.bonusSkill+=1;this.resistance.set("charm",5);this.height=f(165,185,l);this.weight=f(60,80,j);this.increaseDefence("will",1);break;case"Elf":this.origin="Fey";this.speed=7;this.hasLowVision=true;this.increase("dex",2);this.increase("wis",2);this.increaseSkill("nature",2);this.increaseSkill("perception",2);this.height=f(145,185,l);this.weight=f(55,75,j);break;case"Gnoll":this.speed=7;this.hasLowVision=true;this.increase("con",2);this.increase("dex",2);this.increaseSkill("intimidate",2);this.height=f(210,230,l);this.weight=f(125,145,j);break;case"Gnome":this.origin="Fey";this.speed=5;this.hasLowVision=true;this.size="Small";this.increase("int",2);this.increase("cha",2);this.increaseSkill("arcana",2);this.increaseSkill("stealth",2);this.resistance.set("illusion",5);this.height=f(100,115,l);this.weight=f(20,35,j);break;case"Goblin":this.hasLowVision=true;this.size="Small";this.increase("dex",2);this.increase("cha",2);this.increaseSkill("thievery",2);this.increaseSkill("stealth",2);this.increaseDefence("reflex",1);this.height=f(100,115,l);this.weight=f(20,30,j);break;case"Goliath":this.increase("str",2);this.increase("con",2);this.increaseSkill("athletics",2);this.increaseSkill("nature",2);this.increaseDefence("will",1);this.height=f(200,230,l);this.weight=f(125,155,j);break;case"Half-Elf":this.hasLowVision=true;this.increase("cha",2);this.increase("con",2);this.increaseSkill("diplomacy",2);this.increaseSkill("insight",2);this.height=f(165,190,l);this.weight=f(60,85,j);break;case"Half-Orc":this.hasLowVision=true;this.increase("str",2);this.increase("dex",2);this.increaseSkill("endurance",2);this.increaseSkill("intimidate",2);this.height=f(175,195,l);this.weight=f(70,105,j);break;case"Halfling":this.size="Small";this.increase("cha",2);this.increase("dex",2);this.increaseSkill("acrobatics",2);this.increaseSkill("thievery",2);this.height=f(115,130,l);this.weight=f(35,40,j);this.resistance.set("fear",5);break;case"Hobgoblin":this.increase("con",2);this.increase("cha",2);this.increaseSkill("athletics",2);this.increaseSkill("history",2);this.bonusInitiative+=2;this.hasLowVision=true;this.height=f(180,195,l);this.weight=f(85,110,j);break;case"Human":this.bonusSkill+=1;this.bonusAtWill+=1;this.increase(this.preferred[0],2);this.increaseDefence("fort",1);this.increaseDefence("reflex",1);this.increaseDefence("will",1);this.height=f(165,190,l);this.weight=f(60,100,j);break;case"Kobold":this.size="Small";this.increase("dex",2);this.increase("con",2);this.increaseSkill("stealth",2);this.increaseSkill("thievery",2);this.increaseDefence("will",1);this.height=f(105,120,l);this.weight=f(30,35,j);break;case"Minotaur":this.increase("str",2);this.increase("con",2);this.increaseSkill("nature",2);this.increaseSkill("perception",2);this.height=f(210,230,l);this.weight=f(145,160,j);break;case"Orc":this.hasLowVision=true;this.increase("str",2);this.increase("con",2);this.height=f(180,195,l);this.weight=f(90,105,j);break;case"Tiefling":this.hasLowVision=true;this.increase("int",2);this.increase("cha",2);this.increaseSkill("stealth",2);this.increaseSkill("bluff",2);this.resistance.set("fire",5);this.height=f(170,195,l);this.weight=f(65,110,j);break}};this.applyClass=function(j){this.career=j;switch(j){case"Cleric":this.increaseSkill("religion",5);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=12;this.hpLevel=5;this.spdBase=7;break;case"Fighter":this.increaseDefence("fort",2);if(this.npc){this.bonusSkill+=2}else{this.bonusSkill+=3}this.hpBase=15;this.hpLevel=6;this.spdBase=9;break;case"Paladin":this.increaseSkill("religion",5);this.increaseDefence("fort",1);this.increaseDefence("reflex",1);this.increaseDefence("will",1);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=15;this.hpLevel=6;this.spdBase=10;break;case"Ranger":this.increaseSkill("dungeon",5);this.increaseSkill("nature",5);this.increaseDefence("fort",1);this.increaseDefence("reflex",1);if(!this.npc){this.bonusSkill+=3}this.hpBase=12;this.hpLevel=5;this.spdBase=6;break;case"Rogue":this.increaseSkill("stealth",5);this.increaseSkill("thievery",5);this.increaseDefence("reflex",2);if(!this.npc){this.bonusSkill+=4}this.hpBase=12;this.hpLevel=5;this.spdBase=6;break;case"Warlock":this.increaseDefence("will",1);this.increaseDefence("reflex",1);if(this.npc){this.bonusSkill+=2}else{this.bonusSkill+=4}this.hpBase=12;this.hpLevel=5;this.spdBase=6;break;case"Warlord":this.increaseDefence("fort",1);this.increaseDefence("will",1);if(this.npc){this.bonusSkill+=2}else{this.bonusSkill+=4}this.hpBase=12;this.hpLevel=5;this.spdBase=7;break;case"Wizard":this.increaseSkill("arcana",5);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Aristocrat":this.increaseSkill("diplomacy",5);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Artisan":this.increaseSkill("dungeon",5);this.increaseDefence("fort",1);this.increaseDefence("will",1);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Commoner":this.increaseSkill("streetwise",5);this.increaseDefence("fort",1);this.increaseDefence("reflex",1);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Courtesan":this.increaseSkill("insight",5);this.increaseDefence("will",1);this.increaseDefence("reflex",1);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Criminal":this.increaseSkill("thievery",5);this.increaseDefence("reflex",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Healer":this.increaseSkill("heal",5);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Labourer":this.increaseSkill("endurance",5);this.increaseDefence("fort",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Merchant":this.increaseSkill("insight",5);this.increaseDefence("will",1);this.increaseDefence("reflex",1);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Priest":this.increaseSkill("religion",5);this.increaseDefence("will",1);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Scholar":this.increaseSkill("history",5);this.increaseDefence("will",1);if(this.npc){this.bonusSkill+=2}else{this.bonusSkill+=4}this.hpBase=10;this.hpLevel=4;this.spdBase=6;break;case"Artillery":this.increaseSkill("perception",5);this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=8;this.hpLevel=4;this.spdBase=6;break;case"Brute":this.increaseSkill("athletics",5);this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=16;this.hpLevel=5;this.spdBase=7;break;case"Controller":this.increaseSkill("perception",5);this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=12;this.hpLevel=4;this.spdBase=6;break;case"Lurker":this.increaseSkill("stealth",5);this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);this.bonusInitiative+=4;if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=8;this.hpLevel=4;this.spdBase=6;break;case"Skirmisher":this.increaseSkill("athletics",5);this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);this.bonusInitiative+=2;if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=12;this.hpLevel=4;this.spdBase=6;break;case"Soldier":this.increaseSkill("endurance",5);this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);this.bonusInitiative+=2;if(this.npc){this.bonusSkill+=1}else{this.bonusSkill+=3}this.hpBase=12;this.hpLevel=4;this.spdBase=6;break}};this.applyTemplate=function(j){this.template=j;switch(j){case"Minion":break;case"Solo":this.ap=1;this.bonusAtWill+=1;this.savingThrow+=5;break;case"Acolyte":this.origin+=" (demon)";this.resistance.increase("fire",5);this.resistance.increase("necrotic",5);this.resistance.increase("disease",5);this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("will",2);break;case"Adept of Frost":this.origin+=" (elemental)";this.resistance.increase("cold",5);this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("reflex",2);break;case"Adept of Flame":this.origin+=" (elemental)";this.resistance.increase("fire",5);this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("reflex",2);break;case"Adept of Lightning":this.origin+=" (elemental)";this.resistance.increase("lightning",5);this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("reflex",2);break;case"Adept of Thunder":this.origin+=" (elemental)";this.resistance.increase("thunder",5);this.savingThrow+=2;this.ap=1;this.increaseDefence("will",2);this.increaseDefence("reflex",2);break;case"Battle Champion":this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);break;case"Bodyguard":this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",4);this.increaseDefence("reflex",1);this.increaseDefence("will",1);break;case"Death Knight":this.origin+=" (undead)";this.hasDarkVision=true;this.immunity.set("disease",1);this.immunity.set("poison",1);this.resistance.increase("necrotic",5);this.vulnerable.increase("radiant",10);this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",4);this.increaseDefence("will",2);break;case"Death Master":this.origin+=" (shadow)";this.hasDarkVision=true;this.resistance.increase("necrotic",5);this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("will",2);break;case"Demagogue":this.savingThrow+=2;this.ap=1;this.resistance.increase("charm",5);this.resistance.increase("fear",5);this.increaseDefence("fort",2);this.increaseDefence("will",4);break;case"Devastator":this.savingThrow+=2;this.ap=1;this.increaseDefence("reflex",2);break;case"Feyborn":this.origin+=" (fey)";this.savingThrow+=2;this.ap=1;this.increaseDefence("reflex",2);this.increaseDefence("will",2);break;case"Lich":this.origin+=" (undead)";this.hasDarkVision=true;this.immunity.set("disease",1);this.immunity.set("poison",1);this.resistance.increase("necrotic",5);this.savingThrow+=2;this.ap=1;this.regenerate=10;this.increaseDefence("fort",4);this.increaseDefence("will",4);break;case"Mummy Champion":this.origin+=" (undead)";this.hasDarkVision=true;this.immunity.set("disease",1);this.immunity.set("poison",1);this.resistance.increase("necrotic",5);this.savingThrow+=2;this.ap=1;this.regenerate=10;this.increaseDefence("fort",2);this.increaseDefence("will",4);break;case"Mummy Lord":this.origin+=" (undead)";this.hasDarkVision=true;this.immunity.set("disease",1);this.immunity.set("poison",1);this.resistance.increase("necrotic",5);this.savingThrow+=2;this.ap=1;this.regenerate=10;this.increaseDefence("fort",2);this.increaseDefence("will",4);break;case"Savage Berserker":this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",4);this.regenerate=10;break;case"Shadowborn":this.origin+=" (shadow)";this.hasDarkVision=true;this.savingThrow+=2;this.ap=1;this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);break;case"Vampire Lord":this.origin+=" (undead)";this.hasDarkVision=true;this.immunity.set("disease",1);this.immunity.set("poison",1);this.resistance.increase("necrotic",5);this.vulnerable.increase("radiant",5);this.savingThrow+=2;this.ap=1;this.regenerate=10;this.increaseDefence("fort",2);this.increaseDefence("reflex",2);this.increaseDefence("will",2);break;default:this.ap=1;this.savingThrow+=2;break}}}a.prototype=new c();return{blank:new a(),create4E:(function(h,g,m,i,o,n,j,l,q,k){var p=new a(h,g,n);p.set("str",j[0]);p.set("con",j[1]);p.set("dex",j[2]);p.set("int",j[3]);p.set("wis",j[4]);p.set("cha",j[5]);p.preferred=l;p.addDefence("fort","str","con",0);p.addDefence("reflex","dex","int",0);p.addDefence("will","wis","cha",0);p.addSkill("acrobatics","dex",0);p.addSkill("arcana","int",0);p.addSkill("athletics","str",0);p.addSkill("bluff","cha",0);p.addSkill("diplomacy","cha",0);p.addSkill("dungeon","wis",0);p.addSkill("endurance","con",0);p.addSkill("heal","wis",0);p.addSkill("history","int",0);p.addSkill("insight","wis",0);p.addSkill("intimidate","cha",0);p.addSkill("nature","wis",0);p.addSkill("perception","wis",0);p.addSkill("religion","int",0);p.addSkill("stealth","dex",0);p.addSkill("streetwise","cha",0);p.addSkill("thievery","dex",0);p.applyRacial(m,q,k);p.applyClass(i);p.applyTemplate(o);p.levelUp();return p}),serialise:(function(g){if(g.attributes){g.abilities=g.attributes}return JSON.stringify(g)}),deserialise:(function(g){var h=JSON.parse(g);if(h!==null&&typeof h==="object"){var i=new a(h.name,h.level,h.npc);for(key in h){if(typeof h[key]==="object"){switch(key){case"abilities":for(attribute in h[key]){i.set(attribute,h[key][attribute])}break;case"defence":for(defence in h[key]){i.addDefence(defence,h[key][defence].attribute1,h[key][defence].attribute1,h[key][defence].value)}break;case"immunity":for(immunity in h[key].attributes){i.immunity.set(immunity,h[key].attributes[immunity])}break;case"resistance":for(resist in h[key].attributes){i.resistance.set(resist,h[key].attributes[resist])}break;case"skill":for(skill in h[key]){i.addSkill(skill,h[key][skill].key,h[key][skill].value)}break;case"vulnerable":for(vuln in h[key].attributes){i.vulnerable.set(vuln,h[key].attributes[vuln])}break;default:i[key]=h[key]}}else{i[key]=h[key]}}return i}return null})}})(window);