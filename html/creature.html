<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1" name="viewport">
	<meta content="Shapies Tabletop RPG Manager" name="description">
	<meta content="Almighty Nassar" name="author">
	<link rel="icon" href="favicon.ico">
	<title>NPC Creator</title>
	<!-- CSS SCRIPTS -->
	<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap.min.css" media="all">
	<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap-theme.min.css" media="all">
</head>
<body>
	<p><button id="saveCreature">Save</button></p>
	<div id="character_card">
		<h4 id="txt_character">Character Card</h4>
		<table border=1 style="text-align: center;">
			<tr style="background-color: lightgrey;">
				<th>Level</th>
				<th>Race</th>
				<th>Class</th>
				<th>Sub-class</th>
				<th>Origin</th>
				<th>Size</th>
				<th>XP</th>
			</tr>
			<tr>
				<td id="txt_level"></td>
				<td id="txt_race"></td>
				<td id="txt_class"></td>
				<td id="txt_template"></td>
				<td id="txt_origin"></td>
				<td id="txt_size">Medium</td>
				<td id="txt_xp">0</td>
			</tr>
				<tr style="background-color: lightgrey;">
				<th>HP</th>
				<th>Bloodied</th>
				<th>Surge Value</th>
				<th># Surges</th>
				<th>Initiative</th>
				<th>Speed</th>
				<th>Vision</th>
			</tr>
			<tr>
				<td id="txt_hp">0</td>
				<td id="txt_blood">0</td>
				<td id="txt_surge">0</td>
				<td id="txt_spd">0</td>
				<td id="txt_init">0</td>
				<td id="txt_speed">0</td>
				<td id="txt_vision"></td>
			</tr>
			<tr style="background-color: lightgrey;">
				<th>AC</th>
				<th>FORT</th>
				<th>REF</th>
				<th>WILL</th>
				<th>RESIST</th>
				<th>VULN</th>
				<th>IMMUNE</th>
			</tr>
			<tr>
				<td id="txt_ac">10</td>
				<td id="txt_for">10</td>
				<td id="txt_ref">10</td>
				<td id="txt_wil">10</td>
				<td><span id="txt_resist"></span></td>
				<td><span  id="txt_vulnerable"></span></td>
				<td><span  id="txt_immune"></span></td>
			</tr>
			<tr style="background-color: lightgrey;">
				<th></th>
				<th>STR</th>
				<th>CON</th>
				<th>DEX</th>
				<th>INT</th>
				<th>WIS</th>
				<th>CHA</th>
			</tr>
			<tr>
				<th>Score</th>
				<td id="txt_str"></td>
				<td id="txt_con"></td>
				<td id="txt_dex"></td>
				<td id="txt_int"></td>
				<td id="txt_wis"></td>
				<td id="txt_cha"></td>
			</tr>
			<tr>
				<th>Mod</th>
				<td id="txt_str_mod"></td>
				<td id="txt_con_mod"></td>
				<td id="txt_dex_mod"></td>
				<td id="txt_int_mod"></td>
				<td id="txt_wis_mod"></td>
				<td id="txt_cha_mod"></td>
			</tr>
			<tr>
				<th>Attack</th>
				<td class="str_attack"></td>
				<td class="con_attack"></td>
				<td class="dex_attack"></td>
				<td class="int_attack"></td>
				<td class="wis_attack"></td>
				<td class="cha_attack"></td>
			</tr>
			<tr style="background-color: lightgrey;">
				<th>ARMOUR</th>
				<th>MELEE</th>
				<th>OFF-HAND</th>
				<th>RANGED</th>
				<th>SEX</th>
				<th>HEIGHT</th>
				<th>WEIGHT</th>
			</tr>
			<tr>
				<td id="txt_armour">+0 Cloth</td>
				<td id="txt_weapon">Empty</td>
				<td id="txt_offhand">Empty</td>
				<td id="txt_range">Empty</td>
				<td id="txt_gender">Male</td>
				<td id="txt_height">155 cm</td>
				<td id="txt_weight">55 kg</td>
			</tr>
		</table>
		<table>
			<tr style="vertical-align: top;">
				<td>
					<table border=1 style="text-align: center;">
						<tr>
							<th colspan=2>Skills</th>
						</tr>
						<tr style="background-color: lightgrey;">
							<th colspan=2>STR (<span class="str_attack"></span>)</th>
						</tr>
						<tr id="ath">
							<td>Athletics</td><td id="txt_athletics">0</td>
						</tr>
						<tr style="background-color: lightgrey;">
							<th colspan=2>CON (<span class="con_attack"></span>)</th>
						</tr>
						<tr  id="end">
							<td>Endurance</td><td id="txt_endurance">0</td>
						</tr>
						<tr style="background-color: lightgrey;">
							<th colspan=2>DEX (<span class="dex_attack"></span>)</th>
						</tr>
						<tr id="acr">
							<td>Acrobatics</td><td id="txt_acrobatics">0</td>
						</tr>
						<tr id="ste">
							<td>Stealth</td><td id="txt_stealth">0</td>
						</tr>
						<tr id="thi">
							<td>Thievery</td><td id="txt_thievery">0</td>
						</tr>
						<tr style="background-color: lightgrey;">
							<th colspan=2>INT (<span class="int_attack"></span>)</th>
						</tr>
						<tr id="arc">
							<td>Arcana</td><td id="txt_arcana">0</td>
						</tr>
						<tr id="his">
							<td>History</td><td id="txt_history">0</td>
						</tr>
						<tr id="rel">
							<td>Religion</td><td id="txt_religion">0</td>
						</tr>
						<tr style="background-color: lightgrey;">
							<th colspan=2>WIS (<span class="wis_attack"></span>)</th>
						</tr>
						<tr id="dun">
							<td>Dungeoneering</td><td id="txt_dungeon">0</td>
						</tr>
						<tr id="hea">
							<td>Heal</td><td id="txt_heal">0</td>
						</tr>
						<tr  id="ins">
							<td>Insight</td><td id="txt_insight">0</td>
						</tr>
						<tr id="nat">
							<td>Nature</td><td id="txt_nature">0</td>
						</tr>
						<tr id="per">
							<td>Perception</td><td id="txt_perception">0</td>
						</tr>
						<tr style="background-color: lightgrey;">
							<th colspan=2>CHA (<span class="cha_attack"></span>)</th>
						</tr>
						<tr id="blu">
							<td>Bluff</td><td id="txt_bluff">0</td>
						</tr>
						<tr id="dip">
							<td>Diplomacy</td><td id="txt_diplomacy">0</td>
						</tr>
						<tr id="int">
							<td>Intimidate</td><td id="txt_intimidate">0</td>
						</tr>
						<tr id="str">
							<td>Streetwise</td><td id="txt_streetwise">0</td>
						</tr>
					</table>
				</td>
				<td>&nbsp;&nbsp;&nbsp;</td>
				<td>
					<div id="power_weapon"></div>
					<hr />
					<div id="power_offhand"></div>
					<hr />
					<div id="power_ranged"></div>
					<hr />
					<div id="power_armour"></div>
					<hr />
					<!-- <div id="power_enchantment"></div>-->
					<p><b>Extra Skills</b> <em>Choose <span id="skill_bonus"></span> skills to be trained in and add 5 to it</em></p>
					<p><b>Extra Feats</b> <em>Choose <span id="feat_bonus"></span> feats</em></p>
					<p><b>At-Will Power</b> <em>Choose <span id="power_atwill"></span> powers</em></p>
					<p><b>Encounter Power</b> <em>Choose <span id="power_encounter"></span> powers</em></p>
					<p><b>Daily Power</b> <em>Choose <span id="power_daily"></span> powers</em></p>
					<p><b>Utility Power</b> <em>Choose <span id="power_utility"></span> powers</em></p>
				</td>
			</tr>
		</table>
	</div>
	<br />
	<!--  <div id="shapies">
	    <canvas id="Shapies" style="border: 5px solid black;" width="100" height="100"></canvas>
	</div> 
	<script src="../js/Shapies.min.js"></script> -->
	<script src="../jquery/jquery.min.js"></script>
	<script src="../bootstrap/js/bootstrap.min.js"></script>
	<script src="../js/dnd.min.js"></script>
	<script>
	// Grabs our information
	function getURLParameter(name) {
		return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
	}
	var creature = null;
	if (getURLParameter('load')) {
		var param = getURLParameter('load');
		creature = DnD.deserialise(localStorage.getItem(param));
	} else {
		creature = DnD.deserialise(localStorage.getItem('DnD.form'));
	}
	if (creature === null || typeof creature !== 'object') {
		window.location.replace("index.html");
	}
	function saveCreature() {
		localStorage.setItem('DnD.creature.' + creature.name + '-' + creature.race + '-' + creature.career, DnD.serialise(creature));
	}
	/* ===========================================
	 * Environment set-up
	 * ===========================================
	 */
	window.onload = (function ()
	{
		// Save creature
	    window.document.getElementById('saveCreature').onclick = saveCreature;
		/*
    	 * Display basic info
    	 */
    	window.document.getElementById('txt_character').innerHTML = creature.name;
    	window.document.getElementById('txt_level').innerHTML = creature.level;
    	window.document.getElementById('txt_race').innerHTML = creature.race;
    	window.document.getElementById('txt_class').innerHTML = creature.career;
    	window.document.getElementById('txt_xp').innerHTML = creature.xp();
    	window.document.getElementById('txt_template').innerHTML = creature.template;
    	window.document.getElementById('txt_gender').innerHTML = creature.gender;
        window.document.getElementById('txt_vision').innerHTML = creature.vision();
        window.document.getElementById('txt_size').innerHTML = creature.size;
        window.document.getElementById('txt_origin').innerHTML = creature.origin;
        window.document.getElementById('txt_height').innerHTML = creature.height + " cm";
        window.document.getElementById('txt_weight').innerHTML = creature.weight + " kg";
    	/*
    	 * Display ability scores
    	 */
        window.document.getElementById('txt_str').innerHTML = creature.get("str");
        window.document.getElementById('txt_con').innerHTML = creature.get("con");
        window.document.getElementById('txt_dex').innerHTML = creature.get("dex");
        window.document.getElementById('txt_int').innerHTML = creature.get("int");
        window.document.getElementById('txt_wis').innerHTML = creature.get("wis");
        window.document.getElementById('txt_cha').innerHTML = creature.get("cha");
        /*
         * Ability mods and attacks
         */
        window.document.getElementById('txt_str_mod').innerHTML = creature.mod("str");
        window.document.getElementById('txt_con_mod').innerHTML = creature.mod("con");
        window.document.getElementById('txt_dex_mod').innerHTML = creature.mod("dex");
        window.document.getElementById('txt_int_mod').innerHTML = creature.mod("int");
        window.document.getElementById('txt_wis_mod').innerHTML = creature.mod("wis");
        window.document.getElementById('txt_cha_mod').innerHTML = creature.mod("cha");
        $('.str_attack').html(creature.attack("str"));
        $('.con_attack').html(creature.attack("con"));
        $('.dex_attack').html(creature.attack("dex"));
        $('.int_attack').html(creature.attack("int"));
        $('.wis_attack').html(creature.attack("wis"));
        $('.cha_attack').html(creature.attack("cha"));
        /*
         * Health, Speed and initiative
         */
        window.document.getElementById('txt_init').innerHTML = creature.initiative();
        window.document.getElementById('txt_speed').innerHTML = creature.getSpeed() + " squares";
        window.document.getElementById('txt_hp').innerHTML = creature.hp();
        window.document.getElementById('txt_blood').innerHTML = creature.bloodied();
        window.document.getElementById('txt_surge').innerHTML = creature.surge();
        window.document.getElementById('txt_spd').innerHTML = creature.surgePerDay();
        /*
         * Defences and resistances
         */
        window.document.getElementById('txt_ac').innerHTML = creature.ac();
        window.document.getElementById('txt_for').innerHTML = creature.getDefence("fort");
        window.document.getElementById('txt_ref').innerHTML = creature.getDefence("reflex");
        window.document.getElementById('txt_wil').innerHTML = creature.getDefence("will");
        window.document.getElementById('txt_resist').innerHTML = creature.getResists();
        window.document.getElementById('txt_vulnerable').innerHTML = creature.getVulnerable();
        window.document.getElementById('txt_immune').innerHTML = creature.getImmune();
        /*
         * Skills
         */
        if (creature.attack("str") < creature.getSkill("athletics")) {
        	$('#txt_athletics').html(creature.getSkill("athletics"));
        } else {
        	$('#ath').hide();
        }
        if (creature.attack("con") < creature.getSkill("endurance")) {
        	$('#txt_endurance').html(creature.getSkill("endurance"));
        } else {
        	$('#end').hide();
        }
        if (creature.attack("dex") < creature.getSkill("acrobatics")) {
        	$('#txt_acrobatics').html(creature.getSkill("acrobatics"));
        } else {
        	$('#acr').hide();
        }
        if (creature.attack("dex") < creature.getSkill("stealth")) {
        	$('#txt_stealth').html(creature.getSkill("stealth"));
        } else {
        	$('#ste').hide();
        }
        if (creature.attack("dex") < creature.getSkill("thievery")) {
        	$('#txt_thievery').html(creature.getSkill("thievery"));
        } else {
        	$('#thi').hide();
        }
        if (creature.attack("int") < creature.getSkill("arcana")) {
        	$('#txt_arcana').html(creature.getSkill("arcana"));
        } else {
        	$('#arc').hide();
        }
        if (creature.attack("int") < creature.getSkill("history")) {
        	$('#txt_history').html(creature.getSkill("history"));
        } else {
        	$('#his').hide();
        }
        if (creature.attack("int") < creature.getSkill("religion")) {
        	$('#txt_religion').html(creature.getSkill("religion"));
        } else {
        	$('#rel').hide();
        }
        if (creature.attack("wis") < creature.getSkill("dungeon")) {
        	$('#txt_dungeon').html(creature.getSkill("dungeon"));
        } else {
        	$('#dun').hide();
        }
        if (creature.attack("wis") < creature.getSkill("heal")) {
        	$('#txt_heal').html(creature.getSkill("heal"));
        } else {
        	$('#hea').hide();
        }
        if (creature.attack("wis") < creature.getSkill("insight")) {
        	$('#txt_insight').html(creature.getSkill("insight"));
        } else {
        	$('#ins').hide();
        }
        if (creature.attack("wis") < creature.getSkill("nature")) {
        	$('#txt_nature').html(creature.getSkill("nature"));
        } else {
        	$('#nat').hide();
        }
        if (creature.attack("wis") < creature.getSkill("perception")) {
        	$('#txt_perception').html(creature.getSkill("perception"));
        } else {
        	$('#per').hide();
        }
        if (creature.attack("cha") < creature.getSkill("bluff")) {
        	$('#txt_bluff').html(creature.getSkill("bluff"));
        } else {
        	$('#blu').hide();
        }
        if (creature.attack("cha") < creature.getSkill("diplomacy")) {
        	$('#txt_diplomacy').html(creature.getSkill("diplomacy"));
        } else {
        	$('#dip').hide();
        }
        if (creature.attack("cha") < creature.getSkill("intimidate")) {
        	$('#txt_intimidate').html(creature.getSkill("intimidate"));
        } else {
        	$('#int').hide();
        }
        if (creature.attack("cha") < creature.getSkill("streetwise")) {
        	$('#txt_streetwise').html(creature.getSkill("streetwise"));
        } else {
        	$('#str').hide();
        }
        /**
         * Other details
         */
        window.document.getElementById('txt_armour').innerHTML = creature.armour.name + "<br />(+" + creature.armour.enchantment + " " + creature.armour.type + ")";
        window.document.getElementById('txt_weapon').innerHTML = creature.melee.name + "<br />(+" + creature.melee.enchantment + " " + creature.melee.type + ")";
        window.document.getElementById('txt_offhand').innerHTML = creature.offhand.name + "<br />(+" + creature.offhand.enchantment + " " + creature.offhand.type + ")";
        window.document.getElementById('txt_range').innerHTML = creature.range.name + "<br />(+" + creature.range.enchantment + " " + creature.range.type + ")";
        window.document.getElementById('skill_bonus').innerHTML = creature.bonusSkill;
        window.document.getElementById('feat_bonus').innerHTML = creature.getFeats();
        window.document.getElementById('power_armour').innerHTML = creature.getArmourPower();
        window.document.getElementById('power_weapon').innerHTML = creature.getMeleePower();
        window.document.getElementById('power_offhand').innerHTML = creature.getOffhandPower();
        window.document.getElementById('power_ranged').innerHTML = creature.getRangePower();
        window.document.getElementById('power_atwill').innerHTML = creature.getAtWill();
        window.document.getElementById('power_encounter').innerHTML = creature.getEncounter();
        window.document.getElementById('power_daily').innerHTML = creature.getDaily();
        window.document.getElementById('power_utility').innerHTML = creature.getUtility();
        /*
         * Crappy portrait
         
        Shapies.canvas().start();
        var smilie1 = Shapies.actors.create('smilie');
        smilie1.radius = 50;
        smilie1.point = Shapies.canvas().midpoint();
        Shapies.canvas().addActor('smilie1', smilie1);
        */
	});
	</script>
</body>
</html>