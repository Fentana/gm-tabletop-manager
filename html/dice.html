<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1" name="viewport">
	<meta content="Shapies Tabletop RPG Manager" name="description">
	<meta content="Almighty Nassar" name="author">
	<link rel="icon" href="favicon.ico">
	<title>Dice Roller</title>
	<!-- CSS SCRIPTS -->
	<link rel="stylesheet" type="text/css" href="../css/bootstrap.css" media="all">
	<link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.css" media="all">
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-md-5 well">
				<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
				  <div class="panel panel-default">
				    <div class="panel-heading" role="tab" id="headingOne">
				      <h4 class="panel-title">
				        <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
				           Options
				        </a>
				      </h4>
				    </div>
				    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				      <div class="panel-body">
				      	<p>Type of Roll:
					      	<select id="type" class="form-control">
						    	<option value="normal">Standard</option>
						    	<option value="adv">Advantage</option>
						    	<option value="dis">Disadvantage</option>
						    </select>
				      	</p>
				      	<p>
				      		Difficulty Challenge:
				      		<input type="number" id="dc" class="form-control" value="10" />
				      	</p>
				      </div>
				    </div>
				  </div>
				  <div class="panel panel-default">
				    <div class="panel-heading" role="tab" id="headingTwo">
				      <h4 class="panel-title">
				        <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
				          Saved dice
				        </a>
				      </h4>
				    </div>
				    <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingTwo">
				      <div id="saves" class="panel-body">
				      </div>
				    </div>
				  </div>
				</div>
			</div>
			<div class="col-md-7">
				<p class="form-inline"><b>Number of dice:</b> <input type="number" id="number" class="form-control" value='1' /></p>
				<p class="form-inline"><b>Sides on dice</b> <input type="number" id="sides" class="form-control" value='20' /></p>
				<p class="form-inline"><b>Modifier</b>
					<select id="mod" class="form-control">
						<option value="+">+</option>
						<option value="-">-</option>
					</select>
					<input type="number" id="modval" class="form-control"  value='0' />
				</p>
				<p class="form-inline">
					<button onclick='roll();' class="btn btn-primary">Roll!</button> or <button onclick='save();' class="btn btn-success">Save!</button>
				 	<input id="name" class="form-control"  value='Dice Name' />
				</p>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 well">
				<div id="Dice">
				</div>
			</div>
		</div>
	</div>
	<script src="../js/jquery.js"></script>
	<script src="../js/bootstrap.js"></script>
	<script src="../js/dice.js"></script>
	<script>
	function roll() {
		var number = parseInt($("#number").val(), 10);
		var sides = parseInt($("#sides").val(), 10);
		var mod = $('#mod').val() === '+';
		var modval = parseInt($("#modval").val(), 10);
		var dc = parseInt($('#dc').val(), 10);
		var die = Dice.dice(sides, number);
		switch ($('#type').val()) {
			case 'adv':
				var temp = Dice.dice(sides, number);
				die = (temp > die) ? temp : die;
				break;
			case 'dis':
				var temp = Dice.dice(sides, number);
				die = (temp < die) ? temp : die;
				break;
		}
		var result = 0;
		if (mod) {
			result = die + modval;
		} else {
			result = die - modval;
		}
		$("#Dice").prepend("<p><b>Rolling "+number+"d"+sides+":</b> "+die+" "+$('#mod').val()+" "+modval+" ("+$('#type').val()+")</p><h class='btn "+(result >= dc ? "btn-info" : "btn-danger")+"'>"+result+"</h1>");
	}
	function save() {
		var dice = {
			'number': parseInt($("#number").val(), 10),
			'sides': parseInt($("#sides").val(), 10),
			'mod': $('#mod').val() === '+',
			'modval': parseInt($("#modval").val(), 10),
			'name': $("#name").val()
		}
		var dices = (typeof localStorage['dice'] === "undefined") ? {} : JSON.parse(localStorage['dice']);
		dices[$("#name").val()] = dice;
		localStorage.setItem('dice', JSON.stringify(dices));
		$('#saves').html('');
		list();
	}
	function list() {
		var die = JSON.parse(localStorage['dice']);
		for (dice in die) {
			$('#saves').append('<p><button onclick="$(\'#number\').val('+die[dice].number+');$(\'#sides\').val('+die[dice].sides+');$(\'#mod\').val('+((die[dice].mod === true) ? "'+'" : "'-'")+');$(\'#modval\').val('+die[dice].modval+');" class="btn btn-info">Load</button> <button onclick="delDice(\''+dice+'\')" class="btn btn-danger">Delete</button>'+dice+' ('+die[dice].number+'d'+die[dice].sides+(die[dice].mod ? '+' : '-')+die[dice].modval+')</p>');
		}
	}
	function delDice(diceName) {
		var die = JSON.parse(localStorage['dice']);
		delete die[diceName];
		localStorage.setItem('dice', JSON.stringify(die));
		$('#saves').html('');
		list();
	}
	$('.collapse').collapse();
	list();
	</script>
</body>
</html>