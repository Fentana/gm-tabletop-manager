<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1" name="viewport">
	<meta content="Shapies Tabletop RPG Manager" name="description">
	<meta content="Almighty Nassar" name="author">
	<link rel="icon" href="favicon.ico">
	<title>Dice Roller</title>
	<!-- CSS SCRIPTS -->
	<link rel="stylesheet" type="text/css" href="../css/bootstrap.css" media="all">
	<link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.css" media="all">
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-5 well">
				<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
				  <div class="panel panel-default">
				    <div class="panel-heading" role="tab" id="headingOne">
				      <h4 class="panel-title">
				        <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
				           Options
				        </a>
				      </h4>
				    </div>
				    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
				      <div class="panel-body">
				      	<p>Type of Roll:
					      	<select id="type" class="form-control">
						    	<option value="normal">Standard</option>
						    	<option value="adv">Advantage</option>
						    	<option value="dis">Disadvantage</option>
						    </select>
				      	</p>
				      	<p>
				      		Difficulty Challenge:
				      		<input type="number" id="dc" class="form-control" value="10" />
				      	</p>
				      </div>
				    </div>
				  </div>
				  <div class="panel panel-default">
				    <div class="panel-heading" role="tab" id="headingTwo">
				      <h4 class="panel-title">
				        <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
				          Saved dice
				        </a>
				      </h4>
				    </div>
				    <div id="collapseTwo" class="panel-collapse collapse in panel-body" role="tabpanel" aria-labelledby="headingTwo">
				      <p class="form-inline">
				 		<input id="name" class="form-control"  value='Dice Name' />
				 		<button onclick='save();' class="btn btn-success">Save!</button>
					  </p>
				      <div id="saves">
				      </div>
				    </div>
				  </div>
				</div>
			</div>
			<div class="col-md-7">
				<p class="form"><b>Number of dice:</b> <input type="number" id="number" class="form-control" value='1' /></p>
				<p class="form"><b>Sides on dice</b> <input type="number" id="sides" class="form-control" value='20' /></p>
				<p><b>Modifier</b></p>
				<p>
					<span class="form-inline">
						<select id="mod" class="form-control">
							<option value="+">+</option>
							<option value="-">-</option>
						</select>
						<input type="number" id="modval" class="form-control"  value='0' />
					</span>
				</p>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<button onclick='roll();' class="btn btn-block btn-lg btn-primary">Roll!</button>
				<br />
				<br />
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 well">
				<div id="Dice">
				</div>
			</div>
		</div>
	</div>
	<script src="../js/lib/jquery.js"></script>
	<script src="../js/lib/bootstrap.js"></script>
	<script src="../js/dice.js"></script>
	<script>
	function roll() {
		var number = parseInt($("#number").val(), 10);
		var sides = parseInt($("#sides").val(), 10);
		var mod = $('#mod').val() === '+';
		var modval = parseInt($("#modval").val(), 10);
		var adv = ($('#type').val() === "adv") ? 1 : (($('#type').val() === "dis") ? -1 : 0); 
		var dc = parseInt($('#dc').val(), 10);
		var die = Dice.dice(sides, number, adv);
		var result = 0;
		if (mod) {
			result = die + modval;
		} else {
			result = die - modval;
		}
		$("#Dice").prepend("<p><b>Rolling "+number+"d"+sides+":</b> "+die+" "+$('#mod').val()+" "+modval+" ("+$('#type').val()+")</p><h class='btn "+(result >= dc ? "btn-info" : "btn-danger")+"'>"+result+"</h1>");
	};
	function save() {
		Dice.save($("#sides").val(), $("#number").val(), ($('#mod').val() === '+'), $("#modval").val(), $("#name").val());
		list();
	};
	function list() {
		$('#saves').html('');
		var dies = Dice.all();
		for (var dice in dies) {
			$('#saves').append('<p>'+dice+' ('+dies[dice].number+'d'+dies[dice].sides+(dies[dice].mod ? '+' : '-')+dies[dice].modval+') <button onclick="load(\''+dies[dice].name+'\');" class="btn btn-xs btn-info">Load</button> <button onclick="removeDice(\''+dies[dice].name+'\');" class="btn btn-xs btn-danger">Delete</button></p>');
		}
	};
	function load(diceName) {
		var dice = Dice.get(diceName);
		if (dice) {
			$('#number').val(dice.number);
			$('#sides').val(dice.sides);
			$('#mod').val((dice.mod === true) ? "+" : "-");
			$('#modval').val(dice.modval);
			$('#name').val(dice.name);
		}
	}
	function removeDice(diceName) {
		Dice.removeDice(''+diceName);
		list();
	};
	$('.collapse').collapse();
	list();
	</script>
</body>
</html>