<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1" name="viewport">
	<meta content="Shapies Tabletop RPG Manager" name="description">
	<meta content="Almighty Nassar" name="author">
	<link rel="icon" href="favicon.ico">
	<title>NPC Creator</title>
	<!-- CSS SCRIPTS -->
	<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap.min.css" media="all">
	<link rel="stylesheet" type="text/css" href="../bootstrap/css/bootstrap-theme.min.css" media="all">
	<link rel="stylesheet" type="text/css" href="../css/form.min.css" media="all">
</head>
<body>
	<div id="DnD">
		<h4>D&D 4E NPC Generator</h4>
		<p><em>GM Tabletop Manager generates names based on 'Race' and 'Gender'. Changing these attributes below will change the style of name generated</em></p>
		<table>
			<thead></thead>
			<tbody>
				<tr>
					<th>Race</th>
					<th>Gender</th>
					<th>Name</th>
					<th></th>
					<th></th>
				</tr>
				<tr>
					<td><select id="race_input" class="form-control" name="race_input" ></select></td>
					<td><select id="gender_input" class="form-control" name="gender_input"><option value="male">Male</option><option value="female">Female</option></select></td>
					<td><input id="name_input" class="form-control" name="name_input" /></td>
					<td><button class="btn btn-info" onclick='markovName();'>Generate Short Name</button></td>
					<td><button class="btn btn-info" onclick='markovName(8);'>Generate Long Name</button></td>
				</tr>
				<tr>
					<th>Height</th>
					<th>Weight</th>
					<th>Age</th>
					<th>Level</th>
					<th>NPC?</th>
				</tr>
				<tr>
					<td><select id="height_input" class="form-control" name="height_input"><option value="0">Tiny</option><option value="1">Short</option><option value="2">Average</option><option value="3">Tall</option><option value="4">Big</option></select></td>
					<td><select id="weight_input" class="form-control" name="weight_input"><option value="0">Very Light</option><option value="1">Light</option><option value="2">Average</option><option value="3">Heavy</option><option value="4">Very Heavy</option></select></td>
					<td><select id="age_input" class="form-control" name="age_input"><option value="0">Child</option><option value="1">Young Adult</option><option value="2">Middle Age</option><option value="3">Old</option><option value="4">Venerable</option></select></td>
					<td><select id="level_input" class="form-control" name="level_input" ></select></td>
					<td><input id="npc_input" type="checkbox" value="true" name="npc_input"></td>
				</tr>
				<tr>
					<th>Class</th>
					<th>Template</th>
					<th>Background</th>
					<th>Home Town</th>
					<th>Personality</th>
				</tr>
				<tr>
					<td><span id="classes"></span></td>
					<td><span id="templates"></span></td>
					<td><select id="background_input" class="form-control" name="background_input" ></select></td>
					<td><select id="location_input" class="form-control" name="location_input" ></select></td>
					<td></td>
				</tr>
			</tbody>
		</table>
		<hr />
		<h4>ATTRIBUTES</h4>
		<p><em>Drag and drop the order of your preferences - This will be used to automatically allocate level-up attributes and for the generator</em> <span id="prefs"></span></p>
		<table>
			<thead>
				<tr>
					<th>STR</th>
					<th>CON</th>
					<th>DEX</th>
					<th>INT</th>
					<th>WIS</th>
					<th>CHA</th>
					<th></th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><select id="str_input" class="form-control" name="str_input" ></select></td>
					<td><select id="con_input" class="form-control" name="con_input" ></select></td>
					<td><select id="dex_input" class="form-control" name="dex_input" ></select></td>
					<td><select id="int_input" class="form-control" name="int_input" ></select></td>
					<td><select id="wis_input" class="form-control" name="wis_input" ></select></td>
					<td><select id="cha_input" class="form-control" name="cha_input" ></select></td>
					<td><button class="btn btn-default" id="randomRoll">Random Array</button></td>
					<td><button class="btn btn-default" id="standardRoll">Standard Array</button></td>
				</tr>
				<tr>
					<td id="attribute_calculator" colspan="8">0 points</td>
				</tr>
			</tbody>
		</table>
		<hr />
		<h4>EQUIPMENT</h4>
		<table>
			<thead>
				<tr>
					<th>Type</th>
					<th>Equipment</th>
					<th>Name</th>
					<th>Enchantment</th>
					<th>Effect</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><b>Armour</b></td>
					<td><span id="armour"></span></td>
					<td><input id="armour_name_input" placeholder="Armour Name"></td>
					<td><input id="armour_enchantment_input" placeholder="Enchantment" ></td>
					<td><input id="armour_effect_input" placeholder="Effect"></td>
				</tr>
				<tr>
					<td><b>Melee</b></td>
					<td><span id="melee"></span></td>
					<td><input id="melee_name_input" placeholder="Weapon Name"></td>
					<td><input id="melee_enchantment_input" placeholder="Enchantment" ></td>
					<td><input id="melee_effect_input" placeholder="Effect"></td>
				</tr>
				<tr>
					<td><b>Offhand</b></td>
					<td><span id="offhand"></span></td>
					<td><input id="offhand_name_input" placeholder="Offhand Name"></td>
					<td><input id="offhand_enchantment_input" placeholder="Enchantment" ></td>
					<td><input id="offhand_effect_input" placeholder="Effect"></td>
				</tr>
				<tr>
					<td><b>Range</b></td>
					<td><span id="range"></span></td>
					<td><input id="range_name_input" placeholder="Ranged Weapon Name"></td>
					<td><input id="range_enchantment_input" placeholder="Enchantment" ></td>
					<td><input id="range_effect_input" placeholder="Effect"></td>
				</tr>
			</tbody>
		</table>
		<br />
		<p><button class="btn btn-success" onclick='create();'>Submit</button></p>
	</div>
</body>
<script src="../jquery/jquery.min.js"></script>
<script src="../bootstrap/js/bootstrap.min.js"></script>
<script src="../js/markov.min.js"></script>
<script src="../js/dice.min.js"></script>
<script src="../js/data/names.js"></script>
<script src="../js/data/races4E.js"></script>
<script src="../js/data/locations.js"></script>
<script src="../js/data/backgrounds4E.js"></script>
<script src="../js/form.min.js"></script>
<script src="../js/dnd.min.js"></script>
<script>
	function scoreCalc(value) {
		var intersect = parseInt(value,10) - 10;
		var part1 = (intersect-3) >= 0 ? (intersect-3) : 0;
		var part2 = (intersect-6) >= 0 ? (intersect-6) : 0;
		var part3 = (intersect-7) >= 0 ? (intersect-7) : 0;
		var part4 = (intersect-8) >= 0 ? (intersect-8) : 0;
		return (intersect+part1+part2+part3+part4);
	}
	function calculateScore() {
		var score = 20 - (scoreCalc($('#str_input').val()) + scoreCalc($('#con_input').val()) + scoreCalc($('#dex_input').val()) + scoreCalc($('#int_input').val()) + scoreCalc($('#wis_input').val()) + scoreCalc($('#cha_input').val()));
		$('#attribute_calculator').html(score+" points");
	}
	var creature = DnD.blank;
	/* ===========================================
	 * Environment and Form set-up
	 * ===========================================
	 */
	window.onload = (function ()
	{
		// Our form elements
		var form = new Form();
		// Form dropdowns
		$('#armour').html(form.dropdown("armour"));
		$('#melee').html(form.dropdown("melee"));
		$('#offhand').html(form.dropdown("offhand"));
		$('#range').html(form.dropdown("range"));
		// Levels
	    for(var i = 1; i <= 40; i++) {
			$('#level_input').append('<option value="'+i+'">'+i+'</option>');
		}
		// Races
	    for(var race in Race) {
			$('#race_input').append('<option value="'+race+'">'+race+'</option>');
		}
	    // Backgrounds
	    for(var background in Background) {
			$('#background_input').append('<option value="'+background+'">'+Background[background].name+'</option>');
		}
	 	// Locations
	    for(var location in Location) {
			$('#location_input').append('<option value="'+Location[location]+'">'+Location[location]+'</option>');
		}
	 	// Attributes
	    for(var i = 7; i <= 20; i++) {
			$('#str_input').append('<option value="'+i+'">'+i+'</option>');
			$('#con_input').append('<option value="'+i+'">'+i+'</option>');
			$('#dex_input').append('<option value="'+i+'">'+i+'</option>');
			$('#int_input').append('<option value="'+i+'">'+i+'</option>');
			$('#wis_input').append('<option value="'+i+'">'+i+'</option>');
			$('#cha_input').append('<option value="'+i+'">'+i+'</option>');
		}
	    $('#str_input').click(calculateScore);
	    $('#con_input').click(calculateScore);
	    $('#dex_input').click(calculateScore);
	    $('#int_input').click(calculateScore);
	    $('#wis_input').click(calculateScore);
	    $('#cha_input').click(calculateScore);
	 	// Classes
	    $('#classes').html(form.dropdown("class"));
	    $('#templates').html(form.dropdown("template"));
	    // Form draggables
	    window.document.getElementById('prefs').innerHTML = form.draggable("attributes");
	    form.draggableListeners("attributes");
	    $('#randomRoll').click(function () { form.draggableAssign("attributes", Dice.randomArray()); calculateScore(); });
	    $('#standardRoll').click(function () { form.draggableAssign("attributes", Dice.standardArray()); calculateScore(); });
	});
	/* ===========================================
	 * Generate Markov Name
	 * ===========================================
	 */
	var markovName = function (length) {
		var gender = window.document.getElementById('gender_input').value;
		if (Markov.chain() !== window.document.getElementById('race_input').value + "_" + window.document.getElementById('gender_input').value) {
			switch (window.document.getElementById('race_input').value) {
			case "Dwarf":
				Markov.load(Name.dwarf[gender], window.document.getElementById('race_input').value + "_" + gender);
				break;
			case "Eladrin":
			case "Elf":
			case "Half-Elf":
				Markov.load(Name.elf[gender], window.document.getElementById('race_input').value + "_" + gender);
				break;
			case "Half-Orc":
			case "Orc":
				Markov.load(Name.orc[gender], window.document.getElementById('race_input').value + "_" + gender);
				break;
			default:
				Markov.load(Name.human[gender], window.document.getElementById('race_input').value + "_" + gender);
				break;
			}
		}
		var size = length ? parseInt(length, 10) : 5;
		var name = Markov.make(1,size);
		window.document.getElementById('name_input').value = name.charAt(0).toUpperCase() + name.slice(1);
	};
	/* ===========================================
	 * Create creature
	 * ===========================================
	 */
    var create = function () {
    	/*
    	 * Get basic information
    	 */
    	var name = window.document.getElementById('name_input').value;
    	var level = window.document.getElementById('level_input').value;
    	var race = window.document.getElementById('race_input').value;
    	var career = window.document.getElementById('class_input').value;
    	var template = window.document.getElementById('template_input').value;
    	var npc = window.document.getElementById('npc_input').checked ? 1 : 0;
    	var attributes = [window.document.getElementById('str_input').value,
    	                  window.document.getElementById('con_input').value,
    	                  window.document.getElementById('dex_input').value,
    	                  window.document.getElementById('int_input').value,
    	                  window.document.getElementById('wis_input').value,
    	                  window.document.getElementById('cha_input').value];
    	var prefs = window.document.getElementsByClassName('attributes_drag');
    	var height = window.document.getElementById('height_input').value;
    	var weight = window.document.getElementById('weight_input').value;
    	// Creates the creature
    	creature = new DnD.create4E(name, level, race, career, template, npc, attributes, [prefs[0].innerHTML.toLowerCase(), prefs[1].innerHTML.toLowerCase()], height, weight);
    	creature.gender = window.document.getElementById('gender_input').value;
    	// Add armour and weapons
    	creature.applyArmour(window.document.getElementById('armour_name_input').value, window.document.getElementById('armour_input').value, window.document.getElementById('armour_bonus_input').value);
    	creature.armour.properties[window.document.getElementById('armour_enchantment_input').value] = window.document.getElementById('armour_effect_input').value;
    	creature.applyMelee(window.document.getElementById('melee_name_input').value, window.document.getElementById('melee_input').value, window.document.getElementById('melee_bonus_input').value);
    	creature.melee.properties[window.document.getElementById('melee_enchantment_input').value] = window.document.getElementById('melee_effect_input').value;
    	creature.applyOffhand(window.document.getElementById('offhand_name_input').value, window.document.getElementById('offhand_input').value, window.document.getElementById('offhand_bonus_input').value);
    	creature.offhand.properties[window.document.getElementById('offhand_enchantment_input').value] = window.document.getElementById('offhand_effect_input').value;
    	creature.applyRange(window.document.getElementById('range_name_input').value, window.document.getElementById('range_input').value, window.document.getElementById('range_bonus_input').value);
    	creature.range.properties[window.document.getElementById('range_enchantment_input').value] = window.document.getElementById('range_effect_input').value;
    	// Save the object and go to the other form
    	localStorage.setItem('DnD.form', DnD.serialise(creature));
    	window.location.href = "creature.html";
    };
</script>
</html>
