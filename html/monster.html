<!doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta charset="utf-8">
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1" name="viewport">
	<meta content="Shapies Tabletop RPG Manager" name="description">
	<meta content="Almighty Nassar" name="author">
	<link rel="icon" href="favicon.ico">
	<title>Monster Creator</title>
	<!-- CSS SCRIPTS -->
	<link rel="stylesheet" type="text/css" href="../css/bootstrap.css" media="all">
	<link rel="stylesheet" type="text/css" href="../css/bootstrap-theme.css" media="all">
	<link rel="stylesheet" type="text/css" href="../css/form.css" media="all">
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12 well">
				<p><strong>Disclaimer:</strong> <em>This Monster Creator is inspired by D&amp;D 5th Edition, but should not be considered compatible with that edition. The terms used in the creator have come from the OGL content. The mechanics and assumptions used by this Creator do not follow the specifications provided in any published materials. Use this Creator at your own discretion, and please double check the final figures are compatible with your edition. Also, this is not meant for Player Character creation</em></p>
				<h4>Notes</h4>
				<ul>
					<li>Averages of a dice roll: 1d4 = 2.5; 1d6 = 3.5; 1d8 = 4.5; 1d10 = 5.5; 1d12 = 6.5; 1d20 = 10.5</li>
					<li>JavaScript is required to be enabled for the Creator to run adequately</li>
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div id="form" class="form">
					<div class="form-group">
						<label class="control-label">Name</label>
						<input type="text" name="name" id="formName" class="form-control">
					</div>
					<div class="form-group">
						<label class="control-label">Level</label>
						<input type="number" name="level" id="formLevel" value="0" class="form-control">
					</div>
					<div class="form-group">
						<label class="control-label">Type</label>
						<select id="formType" class="form-control"></select>
					</div>
					<div class="form-group">
						<label class="control-label">Size</label>
						<select id="formSize" class="form-control"></select>
					</div>
					<div class="form-group">
						<label class="control-label">Morals</label>
						<select id="formMoral" class="form-control"></select>
					</div>
					<div class="form-group">
						<label class="control-label">Ethics</label>
						<select id="formEthic" class="form-control"></select>
					</div>
					<div class="form-group">
						<label class="control-label">Armour Type</label>
						<select id="formArmour" class="form-control"></select>
					</div>
					<hr />
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-4 well">
				<p><label class="control-label">Speed</label></p>
				<div id="formSpeed"></div>
			</div>
			<div class="col-md-4">
				<p><label class="control-label">Senses</label></p>
				<div id="formSense"></div>
			</div>
			<div class="col-md-4 well">
				<p><label class="control-label">Bonus</label></p>
				<div id="formBonus"></div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-4">		
				<p><label class="control-label">Languages</label></p>
				<div id="formLang"></div>
			</div>
			<div class="col-md-4 well">	
				<p><label class="control-label">Skills</label></p>
				<div id="formSkill" class="form-group checkbox"></div>
			</div>
			<div class="col-md-4">	
				<p><label class="control-label">Tools</label></p>
				<div id="formTool"></div>
			</div>
		</div>		
		<div class="row">
			<div class="col-md-12">
				<label class="control-label">Attributes</label>
				<p><em>The following is the standard attribute array: 8,10,12,13,14,15</em></p>				
				<div id="form" class="form form-inline">
					<table class="table table-condensed">
						<thead>
							<tr>
								<th>Attribute</th>
								<th>Value</th>
								<th>Modifier</th>
								<th>Proficiency Roll (Attack/Skill)</th>
								<th>Magic Save DC</th>
							</tr>
						</thead>
						<tbody id="attributeTable">
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">	
				<div id="AttackForm" class="form form-inline">
					<h3>Actions</h3>
					<p><em>Use the Proficiency Attack Roll and the Magic Save DC in the attributes table as a guide to building your monster's particular action. This section is free-form to give you maximum control over your creature.</em></p>
					<p><strong>Type</strong> refers to the way this action is to be used. For instance, it can be "Attack", "Reaction", or "Trait"</p>
					<p>You will need to specifically click on the 'Add' button for the action to be added to the final monster</p>
					<p><a href='#' class='btn btn-primary hidden' id="addAttack">Add</a></p>
					<div class="form-group">
						<input type="text" id="trait_name_1" name="trait_name_1" class="form-control trait_name" placeholder="Type" />
						<input type="text" id="attack_name_1" name="attack_name_1" class="form-control attack_name" placeholder="Name" />
						<textarea rows="2" id="attack_detail_1" name="attack_detail_1" class="form-control attack_detail" placeholder="Details"></textarea>
						<a href="#" class="btn btn-danger removeInput hidden"> Remove</a>
					</div>
				</div>
				<hr />
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">	
				<h4>Adjustments</h4>
				<p><em>Your Offensive CR needs to be manually calculated since it is nearly impossible to create a system that will accept all forms of attack. Enter in the average Damage output for the first three rounds and the main attribute you used for the Attack Roll or Save DC.</em></p>
				<div id="form" class="form">
					<div class="form-group">
						<p class="control-label">Attack Type</p>
						<select id="attack_type" class="form-control" name="attack_type"></select>
					</div>
					<div class="form-group">
						<p class="control-label">Round 1 Damage</p>
						<input type="number" name="rnd_1_dmg" id="rnd_1_dmg" value="0" class="form-control">
					</div>
					<div class="form-group">
						<p class="control-label">Round 2 Damage</p>
						<input type="number" name="rnd_2_dmg" id="rnd_2_dmg" value="0" class="form-control">
					</div>
					<div class="form-group">
						<p class="control-label">Round 3 Damage</p>
						<input type="number" name="rnd_3_dmg" id="rnd_3_dmg" value="0" class="form-control">
					</div>
				</div>
				<hr />
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 well">	
				<div class="form">
					<div class="form-group">
						<label class="control-label">Hit Points</label>
						<p id="hit_points"></p>
					</div>
					<div class="form-group">
						<label class="control-label">Armour Class</label>
						<p id="armour_class"></p>
					</div>
					<div class="form-group">
						<label class="control-label">Defensive CR</label>
						<p id="defence_cr">1/8</p>
					</div>
					<div class="form-group">
						<label class="control-label">Offensive CR</label>
						<p id="offence_cr"></p>
					</div>
					<div class="form-group ">
						<label class="control-label">CR</label>
						<p id="cr"></p>
					</div>
					<div class="form-group">
						<label class="control-label">Proficiency</label>
						<p id="final_prof"></p>
					</div>
				</div>
				<hr />
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">	
				<p><button class="btn btn-success" onclick='create();'>Submit</button></p>
				<hr />
			</div>
		</div>
		<div id="CanvasResult"></div>
	</div>
</body>
<script src="../js/lib/jquery.js"></script>
<script src="../js/lib/bootstrap.js"></script>
<script src="../js/lib/html2canvas.js"></script>
<script src="../js/monster.js"></script>
<script>
	Monster.loadConfig();
	// The attack table
	// Prepare the attributes table
	var listAttribute = Monster.getAttributes();
	$('#attack_type').html('');
	for (var type in listAttribute) {
		$('#attack_type').append('<option value="'+type+'">'+type.toUpperCase()+'</option>');
		$('#attack_type').change(function() {
			generate();
		});
	}
	// Don't use random rolls
	Monster.setAverageRoll(true);
	// Function to generate the form
	function generate() {
		// Prepare the name and level
		$('#formName').val(Monster.getName());
		$('#formLevel').val(Monster.getLevel());
		// Prepare the Type dropdown
		var listType = Monster.listType();
		$('#formType').html('');
		for (var type in listType) {
			$('#formType').append('<option value="'+listType[type][0]+'" '+(listType[type][0] === Monster.getType()?"selected":"")+'>'+(listType[type][0]).toUpperCase()+'</option>');
		}
		// Prepare the Size dropdown
		var listSize = Monster.listSize();
		$('#formSize').html('');
		for (var type in listSize) {
			$('#formSize').append('<option value="'+listSize[type][0]+'" '+(listSize[type][0] === Monster.getSize()?"selected":"")+'>'+(listSize[type][0]).toUpperCase()+'</option>');
		}
		// Prepare the Moral dropdown
		var listMoral = Monster.listMoral();
		$('#formMoral').html('');
		for (var type in listMoral) {
			$('#formMoral').append('<option value="'+listMoral[type][0]+'" '+(listMoral[type][0] === Monster.getMoral()?"selected":"")+'>'+listMoral[type][1]+'</option>');
		}
		// Prepare the Moral dropdown
		var listEthic = Monster.listEthic();
		$('#formEthic').html('');
		for (var type in listEthic) {
			$('#formEthic').append('<option value="'+listEthic[type][0]+'" '+(listEthic[type][0] === Monster.getEthic()?"selected":"")+'>'+listEthic[type][1]+'</option>');
		}
		// Prepare the attributes table
		var listAttribute = Monster.getAttributes();
		$('#attributeTable').html('');
		for (var type in listAttribute) {
			$('#attributeTable').append('<tr><th>'+type+'</th><td><input type="number" name="'+type+'" id="attr_'+type+'" value="'+listAttribute[type]+'" class="form-control" /></td><td id="mod_'+type+'">'+Monster.getMod(type)+'</td><td id="attack_'+type+'">'+Monster.getAttack(type)+'</td><td id="save_'+type+'">'+Monster.getSave(type)+'</td></tr>');
			$('#attr_'+type).change(function() {
				Monster.setAttribute(this.name, $(this).val());
				generate();
			});
		}
		// Prepare the armour table
		var listArmour = Monster.listArmour();
		$('#formArmour').html('');
		for (var type in listArmour) {
			$('#formArmour').append('<option value="'+listArmour[type].name+'" '+(listArmour[type].name === Monster.getArmour()?"selected":"")+'>'+(listArmour[type].name.toUpperCase())+' - '+listArmour[type].description+'</option>');
		}
		// Prepare the speeds
		var listSpeed = Monster.getSpeed();
		$('#formSpeed').html('');
		for (var type in listSpeed) {
			$('#formSpeed').append('<div class="form-group"><p>'+type.toUpperCase()+'</p><input type="number" name="'+type+'" id="speed_'+type+'" value="'+listSpeed[type]+'" class="form-control"></div>');
			$('#speed_'+type).change(function() {
				Monster.setSpeed(this.name, $(this).val());
			});
		}
		// Prepare the senses
		var listSense = Monster.getSense();
		$('#formSense').html('');
		for (var type in listSense) {
			$('#formSense').append('<div class="form-group"><p>'+type.toUpperCase()+'</p><input type="number" name="'+type+'" id="sense_'+type+'" value="'+listSense[type]+'" class="form-control"></div>');
			$('#sense_'+type).change(function() {
				Monster.setSense(this.name, $(this).val());
			});
		}
		// Prepare the bonuses
		var listBonus = Monster.getBonus();
		$('#formBonus').html('');
		for (var type in listBonus) {
			$('#formBonus').append('<div class="form-group"><p>'+type.toUpperCase()+'</p><input type="number" name="'+type+'" id="bonus_'+type+'" value="'+listBonus[type]+'" class="form-control"></div>');
			$('#bonus_'+type).change(function() {
				Monster.setBonus(this.name, $(this).val());
				generate();
			});
		}
		// Prepare the skills
		var listSkill = Monster.getSkills();
		$('#formSkill').html('');
		for (var type in listSkill) {
			$('#formSkill').append('<div class="checkbox"><label><input type="checkbox" name="'+type+'" id="skill_'+type+'" '+(Monster.getSkillProf(type)?"checked":"")+'>'+type.toUpperCase()+'</label></div>');
			$('#skill_'+type).change(function() {
				Monster.setSkillProf(this.name, $(this).val());
			});
		}
		// Prepare the tools
		var listTool = Monster.getTools();
		$('#formTool').html('');
		for (var type in listTool) {
			$('#formTool').append('<div class="checkbox"><label><input type="checkbox" name="'+type+'" id="tool_'+type+'" '+(Monster.getToolProf(type)?"checked":"")+'>'+type.toUpperCase()+'</label></div>');
			$('#tool_'+type).change(function() {
				Monster.setToolProf(this.name, $(this).val());
			});
		}
		// Prepare the languages
		var listLang = Monster.getLang();
		$('#formLang').html('');
		for (var type in listLang) {
			$('#formLang').append('<div class="checkbox"><label><input type="checkbox" name="'+type+'" id="lang_'+type+'" '+(listLang[type]?"checked":"")+'>'+type.toUpperCase()+'</label></div>');
			$('#lang_'+type).change(function() {
				Monster.setLang(this.name, $(this).val());
			});
		}
		var attack_attrib = $('#attack_type').val();
		var average_damage = (parseInt($('#rnd_1_dmg').val(),0) + parseInt($('#rnd_2_dmg').val(),0) + parseInt($('#rnd_3_dmg').val(),0))/3;
		$('#hit_points').html(Monster.getHP());
		$('#armour_class').html(Monster.getAC());
		$('#defence_cr').html(Monster.getDCR());
		$('#offence_cr').html(Monster.getOCR(average_damage, attack_attrib));
		$('#cr').html(Monster.getCR(average_damage, attack_attrib));
		$('#final_prof').html(Monster.getProficiency());
	}
	generate();
	// Form variables
	$('#formName').change(function () { Monster.setName($(this).val()); });
	$('#formLevel').change(function () { Monster.setLevel($(this).val()); generate(); });
	$('#formMoral').change(function () { Monster.setMoral($(this).val()); });
	$('#formEthic').change(function () { Monster.setEthic($(this).val()); });
	$('#formSize').change(function () { Monster.setSize($(this).val()); generate(); });
	$('#formType').change(function () { Monster.setType($(this).val()); generate(); });
	$('#formArmour').change(function () { Monster.setArmour($(this).val()); generate(); });
	$('#rnd_1_dmg').change(function () { generate(); });
	$('#rnd_2_dmg').change(function () { generate(); });
	$('#rnd_3_dmg').change(function () { generate(); });
	/*
	// If Javascript is enabled, then remove our hidden option
	$('#addAttack, #addTrait, #addReaction, .removeInput').removeClass('hidden');
	// Add Attack form line
	$('#addAttack').on('click', function() {
	    var i = $('#AttackForm .form-group').size() + 1;
	    $('<div class="form-group">\
	       	<input id="attack_name_'+i+'" class="form-control attack_name" type="text" placeholder="Name" name="attack_name_'+i+'"> \
	    	<textarea id="attack_detail_'+i+'" class="form-control attack_detail" placeholder="Details" name="attack_detail_'+i+'"></textarea> \
	    	<a class="btn btn-danger removeInput" href="#"> Remove</a>').appendTo(attackDiv);
	    return false;
	});
	// When a remove button is clicked, delete the owning div and renumber everything
	$('#AttackForm').on('click', '.removeInput', function() { 
	    $(this).parent('.form-group').remove();
	    var i = 1;
	    $('#AttackForm .form-group .attack_name').each(function() {
	        this.id='attack_name_'+i;
	        this.name='attack_name_'+i;
	        i++;
	    });
	    var i = 1;
	    $('#AttackForm .form-group .attack_detail').each(function() {
	        this.id='attack_detail_'+i;
	        this.name='attack_detail_'+i;
	        i++;
	    });
	    return false;
	});
	// Calculate Defensive CR from given values
	function rawDCR(hp,ac) {
		ac = parseInt(ac,10);
		hp = parseInt(hp,10);
		var cr = 0;
		// Calculate CR
		if (hp > 805) {
			cr = 30 - (((19-ac)/2)|0);
		} else if (hp > 760) {
			cr = 29 - (((19-ac)/2)|0);
		} else if (hp > 715) {
			cr = 28 - (((19-ac)/2)|0);
		} else if (hp > 670) {
			cr = 27 - (((19-ac)/2)|0);
		} else if (hp > 625) {
			cr = 26 - (((19-ac)/2)|0);
		} else if (hp > 580) {
			cr = 25 - (((19-ac)/2)|0);
		} else if (hp > 535) {
			cr = 24 - (((19-ac)/2)|0);
		} else if (hp > 490) {
			cr = 23 - (((19-ac)/2)|0);
		} else if (hp > 445) {
			cr = 22 - (((19-ac)/2)|0);
		} else if (hp > 400) {
			cr = 21 - (((19-ac)/2)|0);
		} else if (hp > 355) {
			cr = 20 - (((19-ac)/2)|0);
		} else if (hp > 340) {
			cr = 19 - (((19-ac)/2)|0);
		} else if (hp > 325) {
			cr = 18 - (((19-ac)/2)|0);
		} else if (hp > 310) {
			cr = 17 - (((19-ac)/2)|0);
		} else if (hp > 295) {
			cr = 16 - (((18-ac)/2)|0);
		} else if (hp > 280) {
			cr = 15 - (((18-ac)/2)|0);
		} else if (hp > 265) {
			cr = 14 - (((18-ac)/2)|0);
		} else if (hp > 250) {
			cr = 13 - (((18-ac)/2)|0);
		} else if (hp > 235) {
			cr = 12 - (((17-ac)/2)|0);
		} else if (hp > 220) {
			cr = 11 - (((17-ac)/2)|0);
		} else if (hp > 205) {
			cr = 10 - (((17-ac)/2)|0);
		} else if (hp > 190) {
			cr = 9 - (((16-ac)/2)|0);
		} else if (hp > 175) {
			cr = 8 - (((16-ac)/2)|0);
		} else if (hp > 160) {
			cr = 7 - (((15-ac)/2)|0);
		} else if (hp > 145) {
			cr = 6 - (((15-ac)/2)|0);
		} else if (hp > 130) {
			cr = 5 - (((15-ac)/2)|0);
		} else if (hp > 115) {
			cr = 4 - (((14-ac)/2)|0);
		} else if (hp > 100) {
			cr = 3 - (((13-ac)/2)|0);
		} else if (hp > 85) {
			cr = 2 - (((13-ac)/2)|0);
		} else if (hp > 70) {
			cr = 1 - (((13-ac)/2)|0);
		} else {
			cr = 0 - (((13-ac)/2)|0);
		}
		if (cr <= 0) {
			if (hp > 49) {
				cr = '1/2';
			} else if (hp > 35) {
				cr = '1/4';
			} else if (hp > 6) {
				cr = '1/8';
			} else {
				cr = 0
			}
		}
		return cr;
	}
	// Calculate raw Offensive CR
	function calcOCR() {
		var rnd1 = parseInt($('#rnd_1_dmg').val());
		var rnd2 = parseInt($('#rnd_2_dmg').val());
		var rnd3 = parseInt($('#rnd_3_dmg').val());
		var bonus = parseInt($('#offense_bonus').val());
		var result = (rnd1 + rnd2 + rnd3) / 3;
		var cr = 0;
		// Switch up
		if ($("#attack_type").val() === "attack") {
			// Calculate CR
			if (result > 302) {
				cr = 30 - (((14-bonus)/2)|0);
			} else if (result > 284) {
				cr = 29 - (((13-bonus)/2)|0);
			} else if (result > 266) {
				cr = 28 - (((13-bonus)/2)|0);
			} else if (result > 248) {
				cr = 27 - (((13-bonus)/2)|0);
			} else if (result > 230) {
				cr = 26 - (((12-bonus)/2)|0);
			} else if (result > 212) {
				cr = 25 - (((12-bonus)/2)|0);
			} else if (result > 194) {
				cr = 24 - (((12-bonus)/2)|0);
			} else if (result > 176) {
				cr = 23 - (((11-bonus)/2)|0);
			} else if (result > 158) {
				cr = 22 - (((11-bonus)/2)|0);
			} else if (result > 140) {
				cr = 21 - (((11-bonus)/2)|0);
			} else if (result > 122) {
				cr = 20 - (((10-bonus)/2)|0);
			} else if (result > 116) {
				cr = 19 - (((10-bonus)/2)|0);
			} else if (result > 110) {
				cr = 18 - (((10-bonus)/2)|0);
			} else if (result > 104) {
				cr = 17 - (((10-bonus)/2)|0);
			} else if (result > 98) {
				cr = 16 - (((9-bonus)/2)|0);
			} else if (result > 92) {
				cr = 15 - (((8-bonus)/2)|0);
			} else if (result > 86) {
				cr = 14 - (((8-bonus)/2)|0);
			} else if (result > 80) {
				cr = 13 - (((8-bonus)/2)|0);
			} else if (result > 74) {
				cr = 12 - (((8-bonus)/2)|0);
			} else if (result > 68) {
				cr = 11 - (((8-bonus)/2)|0);
			} else if (result > 62) {
				cr = 10 - (((7-bonus)/2)|0);
			} else if (result > 56) {
				cr = 9 - (((7-bonus)/2)|0);
			} else if (result > 50) {
				cr = 8 - (((7-bonus)/2)|0);
			} else if (result > 44) {
				cr = 7 - (((6-bonus)/2)|0);
			} else if (result > 38) {
				cr = 6 - (((6-bonus)/2)|0);
			} else if (result > 32) {
				cr = 5 - (((6-bonus)/2)|0);
			} else if (result > 26) {
				cr = 4 - (((5-bonus)/2)|0);
			} else if (result > 20) {
				cr = 3 - (((4-bonus)/2)|0);
			} else if (result > 14) {
				cr = 2 - (((3-bonus)/2)|0);
			} else if (result > 8) {
				cr = 1 - (((3-bonus)/2)|0);
			} else {
				cr = 0 - (((3-bonus)/2)|0);
			}
			if (cr <= 0) {
				if (result > 5) {
					cr = '1/2';
				} else if (result > 3) {
					cr = '1/4';
				} else if (result > 1) {
					cr = '1/8';
				} else {
					cr = 0
				}
			}
		} else {
			if (result > 302) {
				cr = 30 - (((23-bonus)/2)|0);
			} else if (result > 284) {
				cr = 29 - (((22-bonus)/2)|0);
			} else if (result > 266) {
				cr = 28 - (((22-bonus)/2)|0);
			} else if (result > 248) {
				cr = 27 - (((22-bonus)/2)|0);
			} else if (result > 230) {
				cr = 26 - (((21-bonus)/2)|0);
			} else if (result > 212) {
				cr = 25 - (((21-bonus)/2)|0);
			} else if (result > 194) {
				cr = 24 - (((21-bonus)/2)|0);
			} else if (result > 176) {
				cr = 23 - (((20-bonus)/2)|0);
			} else if (result > 158) {
				cr = 22 - (((20-bonus)/2)|0);
			} else if (result > 140) {
				cr = 21 - (((20-bonus)/2)|0);
			} else if (result > 122) {
				cr = 20 - (((19-bonus)/2)|0);
			} else if (result > 116) {
				cr = 19 - (((19-bonus)/2)|0);
			} else if (result > 110) {
				cr = 18 - (((19-bonus)/2)|0);
			} else if (result > 104) {
				cr = 17 - (((19-bonus)/2)|0);
			} else if (result > 98) {
				cr = 16 - (((18-bonus)/2)|0);
			} else if (result > 92) {
				cr = 15 - (((18-bonus)/2)|0);
			} else if (result > 86) {
				cr = 14 - (((18-bonus)/2)|0);
			} else if (result > 80) {
				cr = 13 - (((18-bonus)/2)|0);
			} else if (result > 74) {
				cr = 12 - (((17-bonus)/2)|0);
			} else if (result > 68) {
				cr = 11 - (((17-bonus)/2)|0);
			} else if (result > 62) {
				cr = 10 - (((16-bonus)/2)|0);
			} else if (result > 56) {
				cr = 9 - (((16-bonus)/2)|0);
			} else if (result > 50) {
				cr = 8 - (((16-bonus)/2)|0);
			} else if (result > 44) {
				cr = 7 - (((15-bonus)/2)|0);
			} else if (result > 38) {
				cr = 6 - (((15-bonus)/2)|0);
			} else if (result > 32) {
				cr = 5 - (((15-bonus)/2)|0);
			} else if (result > 26) {
				cr = 4 - (((14-bonus)/2)|0);
			} else if (result > 20) {
				cr = 3 - (((13-bonus)/2)|0);
			} else if (result > 14) {
				cr = 2 - (((13-bonus)/2)|0);
			} else if (result > 8) {
				cr = 1 - (((13-bonus)/2)|0);
			} else {
				cr = 0 - (((13-bonus)/2)|0);
			}
			if (cr <= 0) {
				if (result > 5) {
					cr = '1/2';
				} else if (result > 3) {
					cr = '1/4';
				} else if (result > 1) {
					cr = '1/8';
				} else {
					cr = 0
				}
			}
		}
		$('#offensive_cr').html(cr);
		calcCR();
	}
	// Calculate Defensive CR
	function calcDCR() {
		// Calculate a raw DCR
		var ac = parseInt($('#armour_class').html(),10);
		var hp = parseInt($('#hit_points').html(),10);
		var cr = rawDCR(hp,ac);
		var prof = 0;
		// Number of immunities
		var immunities = $('input[name="immune"]:checked').length;
		var resistances = $('input[name="resist"]:checked').length;
		// Our saves
		var strSave = ($('#saveStr:checked').length > 0);
		var dexSave = ($('#saveDex:checked').length > 0);
		var conSave = ($('#saveCon:checked').length > 0);
		var intSave = ($('#saveInt:checked').length > 0);
		var wisSave = ($('#saveWis:checked').length > 0);
		var chaSave = ($('#saveCha:checked').length > 0);
		// Our effective DCR values
		var effective_hp = hp;
		var effective_ac = ac;
		// Refine DCR based on immunities and resistances
		if (cr > 7 && immunities > 2) {
			effective_hp = hp*1.25;
		} else if (cr > 5 && (immunities > 2 || resistances > 4)) {
			effective_hp = hp*1.5;
		} else if ((immunities > 2 || resistances > 4)) {
			effective_hp = hp*2;
		}
		// Refine DCR based on Saving Throws
		var count = 0;
		if (strSave) {
			count += 1;
		}
		if (dexSave) {
			count += 1;
		}
		if (conSave) {
			count += 1;
		}
		if (intSave) {
			count += 1;
		}
		if (wisSave) {
			count += 1;
		}
		if (chaSave) {
			count += 1;
		}
		if (count > 4) {
			effective_ac += 4;
		} else if (count > 2) {
			effective_ac += 2;
		}
		// Calculate our actual DCR
		effective_hp += parseInt($('#effective_hp_bonus').val());
		effective_ac += parseInt($('#effective_ac_bonus').val());
		cr = rawDCR(effective_hp,effective_ac);
		switch (cr) {
		case 30:
		case 29:
			prof = 9;
			break;
		case 28:
		case 27:
		case 26:
		case 25:
			prof = 8;
			break;
		case 24:
		case 23:
		case 22:
		case 21:
			prof = 7;
			break;
		case 20:
		case 19:
		case 18:
		case 17:
			prof = 6;
			break;
		case 16:
		case 15:
		case 14:
		case 13:
			prof = 5;
			break;
		case 12:
		case 11:
		case 10:
		case 9:
			prof = 4;
			break;
		case 8:
		case 7:
		case 6:
		case 5:
			prof = 3;
			break;
		default:
			prof = 2;
			break;
		}
		$('#defence_cr').html(cr+'');
		// Effective scores
		$('#effective_hit_points').html(effective_hp);
		$('#effective_armour_class').html(effective_ac);
		// Attack Proficiencies
		$('#prof').html(prof);
		$('#str_atk').html(prof+parseInt($('#str_mod').html()));
		$('#dex_atk').html(prof+parseInt($('#dex_mod').html()));
		$('#con_atk').html(prof+parseInt($('#con_mod').html()));
		$('#int_atk').html(prof+parseInt($('#int_mod').html()));
		$('#wis_atk').html(prof+parseInt($('#wis_mod').html()));
		$('#cha_atk').html(prof+parseInt($('#cha_mod').html()));
		// Attack Proficiencies
		$('#str_save').html(8+prof+parseInt($('#str_mod').html()));
		$('#dex_save').html(8+prof+parseInt($('#dex_mod').html()));
		$('#con_save').html(8+prof+parseInt($('#con_mod').html()));
		$('#int_save').html(8+prof+parseInt($('#int_mod').html()));
		$('#wis_save').html(8+prof+parseInt($('#wis_mod').html()));
		$('#cha_save').html(8+prof+parseInt($('#cha_mod').html()));
		calcOCR();
	}
	// Calculate final CR
	function calcCR() {
		var dcr = eval($('#defence_cr').html());
		var ocr = eval($('#offensive_cr').html());
		var result = ((dcr + ocr) / 2);
		var prof = 0;
		// Our saves
		var strSave = ($('#saveStr:checked').length > 0);
		var dexSave = ($('#saveDex:checked').length > 0);
		var conSave = ($('#saveCon:checked').length > 0);
		var intSave = ($('#saveInt:checked').length > 0);
		var wisSave = ($('#saveWis:checked').length > 0);
		var chaSave = ($('#saveCha:checked').length > 0);
		if (result < 1) {
			if (result >= 0.5) {
				result = '1/2';
			} else if (result >= 0.25) {
				result = '1/4';
			} else if (result >= 0.125) {
				result = '1/8';
			} else {
				result = 0
			}
		} else {
			result = result|0;
		}
		switch (result) {
		case 30:
		case 29:
			prof = 9;
			break;
		case 28:
		case 27:
		case 26:
		case 25:
			prof = 8;
			break;
		case 24:
		case 23:
		case 22:
		case 21:
			prof = 7;
			break;
		case 20:
		case 19:
		case 18:
		case 17:
			prof = 6;
			break;
		case 16:
		case 15:
		case 14:
		case 13:
			prof = 5;
			break;
		case 12:
		case 11:
		case 10:
		case 9:
			prof = 4;
			break;
		case 8:
		case 7:
		case 6:
		case 5:
			prof = 3;
			break;
		default:
			prof = 2;
			break;
		}
		var text = "";
		if (strSave) {
			text += "STR "+ (prof+parseInt($('#str_mod').html())) + ";";
		}
		if (dexSave) {
			text += "DEX "+ (prof+parseInt($('#dex_mod').html())) + ";";
		}
		if (conSave) {
			text += "CON "+ (prof+parseInt($('#con_mod').html())) + ";";
		}
		if (intSave) {
			text += "INT "+ (prof+parseInt($('#int_mod').html())) + ";";
		}
		if (wisSave) {
			text += "WIS "+ (prof+parseInt($('#wis_mod').html())) + ";";
		}
		if (chaSave) {
			text += "CHA "+ (prof+parseInt($('#cha_mod').html())) + ";";
		}
		$('#cr').html(result);
		$('#final_prof').html(prof);
		$('#saves').html(text);
	    //html2canvas(attackDiv, {
	    //    onrendered: function(canvas) {
	    //    	$('#CanvasResult').html(canvas);
	    //    }
	    //});
	}
	*/
</script>
</html>
